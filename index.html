<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©é¦¨å®¶åº­è®°è´¦æœ¬ï¼ˆçº§è”æ—¶é—´ç­›é€‰ç‰ˆï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* å…¨å±€æ ·å¼ - é«˜çº§è´¨æ„Ÿé£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            color: #4a4a48;
            font-weight: 400;
        }
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f2ed;
            min-height: 100vh;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d9d6d0' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(150, 140, 130, 0.06);
            border: 1px solid rgba(233, 230, 225, 0.6);
        }
        h1 {
            text-align: center;
            color: #c87065;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: 500;
            font-size: 22px;
        }

        /* è®¾ç½®æŒ‰é’® */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #c87065;
            color: white !important;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(200, 112, 101, 0.2);
            z-index: 100;
            transition: all 0.3s ease;
        }
        .settings-btn:hover {
            background: #b46056;
            transform: rotate(90deg);
        }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            max-width: 100%;
            height: 100vh;
            background: #ffffff;
            box-shadow: -8px 0 24px rgba(150, 140, 130, 0.1);
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            padding: 40px 20px 20px;
            overflow-y: auto;
        }
        .settings-panel.show {
            transform: translateX(0);
        }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9e6e1;
        }
        .settings-title {
            font-size: 18px;
            font-weight: 500;
            color: #c87065;
        }
        .close-settings {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f8f6f3;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #5c5c59;
        }
        .settings-group {
            margin-bottom: 25px;
        }
        .settings-group-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #5c5c59;
        }
        .custom-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 10px;
            background: #f8f6f3;
            border-radius: 8px;
        }
        .custom-item input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #e9e6e1;
            border-radius: 6px;
            font-size: 14px;
        }
        .custom-item-btn {
            display: flex;
            gap: 5px;
        }
        .custom-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .add-btn {
            background: #7a9d7a;
            color: white !important;
            width: 100%;
            padding: 8px 0;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }
        .save-settings {
            background: #c87065;
            color: white !important;
            width: 100%;
            padding: 12px 0;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            font-size: 15px;
        }

        /* å½•å…¥åŒºåŸŸ */
        .input-section {
            border-bottom: 1px solid #e9e6e1;
            padding-bottom: 25px;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .form-group label {
            width: 80px;
            color: #5c5c59;
            font-weight: 500;
            flex-shrink: 0;
        }
        .form-group select, 
        .form-group input, 
        .form-group textarea {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 1px solid #e9e6e1;
            border-radius: 10px;
            font-size: 14px;
            background: #ffffff;
            transition: all 0.3s ease;
        }
        .form-group select:focus, 
        .form-group input:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #c87065;
            box-shadow: 0 0 0 3px rgba(200, 112, 101, 0.08);
        }
        .form-group button {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .form-group button:hover {
            background: #b46056;
        }
        .form-group .edit-btn {
            background: #7a9d7a;
        }
        .form-group .edit-btn:hover {
            background: #6a8d6a;
        }
        .remark-tags {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .remark-tag {
            padding: 5px 12px;
            background: #f8f6f3;
            border-radius: 6px;
            font-size: 12px;
            color: #5c5c59;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .remark-tag:hover {
            background: #f0ece7;
        }

        /* ç­›é€‰åŒºåŸŸ - çº§è”æ—¶é—´é€‰æ‹©æ–°ç‰ˆ */
        .filter-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            border: 1px solid #e9e6e1;
        }
        .filter-top-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }
        .filter-top-row label {
            font-weight: 500;
            color: #5c5c59;
            flex-shrink: 0;
        }
        /* é€‰ä¸­æ—¶é—´å±•ç¤ºåŒº */
        .selected-time-show {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        .selected-time-text {
            font-size: 16px;
            font-weight: 500;
            color: #c87065;
        }
        .reselect-btn {
            padding: 8px 15px;
            background: #f8f6f3;
            border: 1px solid #e9e6e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        .reselect-btn:hover {
            background: #f0ece7;
            border-color: #d9d6d0;
        }
        /* çº§è”é€‰æ‹©é¢æ¿ */
        .cascade-select-panel {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f6f3;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9e6e1;
        }
        .cascade-select-panel.hide {
            display: none;
        }
        .cascade-item {
            flex: 1;
            min-width: 180px;
        }
        .cascade-title {
            font-size: 14px;
            font-weight: 500;
            color: #5c5c59;
            margin-bottom: 10px;
        }
        .cascade-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
            background: #ffffff;
            border-radius: 6px;
            border: 1px solid #e9e6e1;
        }
        .cascade-option {
            padding: 8px 0;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            border: 1px solid transparent;
        }
        .cascade-option:hover {
            background: #f0ece7;
            border-color: #d9d6d0;
        }
        .cascade-option.active {
            background: #c87065;
            color: white !important;
            border-color: #c87065;
        }
        .cascade-option.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: transparent;
        }
        /* ç­›é€‰æ“ä½œæ  */
        .filter-bottom-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }
        .filter-left-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        /* å¤šé€‰è®°è´¦äººå®¹å™¨ */
        .user-multi-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .user-checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            color: #5c5c59;
        }
        .user-checkbox-item input {
            width: 16px;
            height: 16px;
            accent-color: #c87065;
        }
        /* æ•°æ®å¯¼å‡º/å¯¼å…¥æŒ‰é’® */
        .data-op-btn {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        .data-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            color: white !important;
        }
        .export-btn {
            background: #7a9d7a;
        }
        .export-btn:hover {
            background: #6a8d6a;
        }
        .import-btn {
            background: #5c8a8a;
        }
        .import-btn:hover {
            background: #4c7a7a;
        }
        /* éšè—æ–‡ä»¶è¾“å…¥æ¡† */
        #importFile {
            display: none;
        }
        .confirm-select-btn {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .confirm-select-btn:hover {
            background: #b46056;
        }
        .confirm-select-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #c87065;
        }

        /* ç»Ÿè®¡åŒºåŸŸ */
        .stats-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            border: 1px solid #e9e6e1;
        }
        .stats-title {
            font-weight: 500;
            color: #c87065;
            margin-bottom: 15px;
            font-size: 16px;
        }
        /* é¢„ç®—æ¨¡å— */
        .budget-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f6f3;
            border-radius: 8px;
            border: 1px solid #e9e6e1;
        }
        .budget-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #5c5c59;
        }
        .budget-item {
            margin-bottom: 10px;
        }
        .budget-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .budget-category {
            color: #5c5c59;
        }
        .budget-value {
            color: #c87065;
            font-weight: 500;
        }
        .budget-progress {
            width: 100%;
            height: 8px;
            background: #e9e6e1;
            border-radius: 4px;
            overflow: hidden;
        }
        .budget-progress-bar {
            height: 100%;
            background: #7a9d7a;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .budget-progress-bar.over {
            background: #c87065;
        }
        /* å¯è§†åŒ–å›¾è¡¨åŒºåŸŸ */
        .chart-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-item {
            padding: 15px;
            background: #f8f6f3;
            border-radius: 8px;
            border: 1px solid #e9e6e1;
        }
        .chart-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #5c5c59;
            text-align: center;
        }
        .chart-container {
            width: 100%;
            height: 300px;
        }
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stats-item {
            padding: 15px;
            background: #f8f6f3;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s ease;
            border: 1px solid #e9e6e1;
        }
        .stats-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.08);
        }
        .stats-item .label {
            font-size: 13px;
            color: #8a8a86;
            margin-bottom: 8px;
            font-weight: 400;
        }
        .stats-item .value {
            font-size: 18px;
            font-weight: 500;
        }
        .expense {
            color: #d49667;
        }
        .income {
            color: #7a9d7a;
        }
        .balance {
            color: #c87065;
        }

        /* åˆ†ç±»æ˜ç»†ç»Ÿè®¡ */
        .category-stats {
            margin-top: 20px;
        }
        .category-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #5c5c59;
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        .category-item {
            padding: 10px;
            background: #f8f6f3;
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid #e9e6e1;
        }
        .category-item .name {
            color: #8a8a86;
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* æ˜ç»†åŒºåŸŸ - æ‰¹é‡æ“ä½œ */
        .records-section {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            overflow: hidden;
            border: 1px solid #e9e6e1;
        }
        /* æ‰¹é‡æ“ä½œæ  */
        .batch-operate {
            padding: 10px 15px;
            background: #f8f6f3;
            border-bottom: 1px solid #e9e6e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .batch-select {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .batch-select input {
            width: 18px;
            height: 18px;
            accent-color: #c87065;
        }
        .batch-delete-btn {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .batch-delete-btn:hover {
            background: #b46056;
        }
        .records-section table {
            width: 100%;
            border-collapse: collapse;
        }
        .records-section th, .records-section td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9e6e1;
        }
        /* å¤é€‰æ¡†åˆ— */
        .checkbox-col {
            width: 40px;
            text-align: center !important;
        }
        .records-section th {
            background: #f8f6f3;
            color: #5c5c59;
            font-weight: 500;
            font-size: 14px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .records-section tr:hover {
            background: #faf9f7;
        }
        .operate-btn {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .edit-btn {
            color: #7a9d7a;
            cursor: pointer;
            font-size: 13px;
            transition: color 0.3s ease;
        }
        .edit-btn:hover {
            color: #6a8d6a;
        }
        .delete-btn {
            color: #c87065;
            cursor: pointer;
            font-size: 13px;
            transition: color 0.3s ease;
        }
        .delete-btn:hover {
            color: #b46056;
        }
        .amount-col {
            text-align: right !important;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-box {
            background: #ffffff;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 24px rgba(150, 140, 130, 0.15);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-box {
            transform: translateY(0);
        }
        .modal-title {
            font-size: 18px;
            font-weight: 500;
            color: #4a4a48;
            margin-bottom: 15px;
            text-align: center;
        }
        .modal-content {
            font-size: 14px;
            color: #5c5c59;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }
        .modal-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .modal-btn {
            padding: 10px 25px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .modal-btn.cancel {
            background: #f8f6f3;
            color: #5c5c59;
        }
        .modal-btn.cancel:hover {
            background: #f0ece7;
        }
        .modal-btn.confirm {
            background: #c87065;
            color: white !important;
        }
        .modal-btn.confirm:hover {
            background: #b46056;
        }

        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: #8a8a86;
            text-align: center;
        }
        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            fill: #e9e6e1;
        }
        .empty-state-text {
            font-size: 14px;
            margin-bottom: 8px;
        }
        .empty-state-tip {
            font-size: 12px;
            color: #a0a09c;
        }

        /* Toastæç¤º */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            color: white !important;
            z-index: 99999;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
            justify-content: center;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .toast.success {
            background: #7a9d7a;
        }
        .toast.info {
            background: #5c5c59;
        }
        .toast.warning {
            background: #d49667;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 12px;
            }
            .form-group {
                gap: 10px;
            }
            .form-group label {
                width: 70px;
            }
            .stats-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            .chart-section {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 200px;
            }
            .operate-btn {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
            .cascade-select-panel {
                flex-direction: column;
                gap: 15px;
            }
            .cascade-item {
                min-width: 100%;
            }
            .modal-box {
                padding: 20px;
            }
            .empty-state svg {
                width: 80px;
                height: 80px;
            }
            .operate-btn span {
                display: flex;
                align-items: center;
                gap: 5px;
            }
            .operate-btn span::before {
                content: '';
                display: inline-block;
                width: 14px;
                height: 14px;
            }
            .edit-btn::before {
                content: 'âœï¸';
            }
            .delete-btn::before {
                content: 'ğŸ—‘ï¸';
            }
            .operate-btn span {
                font-size: 0;
            }
            .operate-btn span:hover {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- è®¾ç½®æŒ‰é’® -->
    <div class="settings-btn" onclick="showSettingsPanel()">âš™ï¸</div>
    
    <div class="container">
        <h1>ğŸ¡ æ¸©é¦¨å®¶åº­è®°è´¦æœ¬ï¼ˆçº§è”æ—¶é—´ç­›é€‰ç‰ˆï¼‰</h1>
        
        <!-- è®°è´¦å½•å…¥åŒºåŸŸ -->
        <div class="input-section">
            <div class="form-group">
                <label>è®°è´¦äººï¼š</label>
                <select id="userSelect">
                    <!-- åŠ¨æ€ç”Ÿæˆè®°è´¦äººé€‰é¡¹ -->
                </select>
            </div>
            <div class="form-group">
                <label>æ”¶æ”¯ç±»å‹ï¼š</label>
                <select id="typeSelect" onchange="changeCategoryOptions()">
                    <option value="æ”¯å‡º">æ”¯å‡º</option>
                    <option value="æ”¶å…¥">æ”¶å…¥</option>
                </select>
            </div>
            <div class="form-group">
                <label>å…·ä½“åˆ†ç±»ï¼š</label>
                <select id="categorySelect">
                    <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»é€‰é¡¹ -->
                </select>
            </div>
            <div class="form-group">
                <label>é‡‘é¢ï¼š</label>
                <input type="number" id="amountInput" placeholder="è¯·è¾“å…¥é‡‘é¢" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸï¼š</label>
                <input type="date" id="dateInput">
                <div style="display: flex; gap: 8px; flex-shrink: 0;">
                    <button type="button" style="padding: 8px 12px; font-size: 12px;" onclick="setQuickDate('today')">ä»Šæ—¥</button>
                    <button type="button" style="padding: 8px 12px; font-size: 12px;" onclick="setQuickDate('yesterday')">æ˜¨æ—¥</button>
                </div>
            </div>
            <div class="form-group">
                <label>å¤‡æ³¨ï¼š</label>
                <textarea id="remarkInput" placeholder="è®°å½•æ¶ˆè´¹/æ”¶å…¥åŸå› ï¼ˆå¯é€‰ï¼‰"></textarea>
                <div class="remark-tags">
                    <div class="remark-tag" onclick="fillRemark('è¶…å¸‚é‡‡è´­')">è¶…å¸‚é‡‡è´­</div>
                    <div class="remark-tag" onclick="fillRemark('å¤–å–')">å¤–å–</div>
                    <div class="remark-tag" onclick="fillRemark('å·¥èµ„åˆ°è´¦')">å·¥èµ„åˆ°è´¦</div>
                    <div class="remark-tag" onclick="fillRemark('å…¶ä»–')">å…¶ä»–</div>
                </div>
            </div>
            <div class="form-group">
                <button id="addRecordBtn">âœ¨ æ·»åŠ è®°è´¦è®°å½•</button>
                <button id="editRecordBtn" class="edit-btn" style="display: none;">âœï¸ ä¿å­˜ä¿®æ”¹</button>
                <input type="hidden" id="editRecordId" value="">
            </div>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ - çº§è”æ—¶é—´é€‰æ‹©æ–°ç‰ˆ -->
        <div class="filter-section">
            <!-- é¡¶éƒ¨é€‰ä¸­æ—¶é—´å±•ç¤º -->
            <div class="filter-top-row">
                <label>è´¦å•æ—¶é—´ï¼š</label>
                <div class="selected-time-show">
                    <div class="selected-time-text" id="selectedTimeText">è¯·é€‰æ‹©å¹´/æœˆ/æ—¥æŸ¥çœ‹è´¦å•</div>
                    <button class="reselect-btn" id="reselectBtn" onclick="showCascadePanel()">é‡æ–°é€‰æ‹©</button>
                </div>
            </div>

            <!-- çº§è”é€‰æ‹©é¢æ¿ -->
            <div class="cascade-select-panel" id="cascadeSelectPanel">
                <div class="cascade-item">
                    <div class="cascade-title">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¹´ä»½</div>
                    <div class="cascade-options" id="yearOptions">
                        <!-- åŠ¨æ€ç”Ÿæˆå¹´ä»½é€‰é¡¹ -->
                    </div>
                </div>
                <div class="cascade-item">
                    <div class="cascade-title">ç¬¬äºŒæ­¥ï¼šé€‰æ‹©æœˆä»½</div>
                    <div class="cascade-options" id="monthOptions">
                        <!-- åŠ¨æ€ç”Ÿæˆæœˆä»½é€‰é¡¹ -->
                    </div>
                </div>
                <div class="cascade-item">
                    <div class="cascade-title">ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©æ—¥æœŸ</div>
                    <div class="cascade-options" id="dayOptions">
                        <!-- åŠ¨æ€ç”Ÿæˆæ—¥æœŸé€‰é¡¹ -->
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨æ“ä½œæ  -->
            <div class="filter-bottom-row">
                <div class="filter-left-group">
                    <label>è®°è´¦äººï¼š</label>
                    <div class="user-multi-filter" id="userMultiFilter">
                        <!-- åŠ¨æ€ç”Ÿæˆè®°è´¦äººå¤é€‰æ¡† -->
                    </div>
                    <button class="confirm-select-btn" id="confirmSelectBtn" onclick="confirmTimeSelect()" disabled>ç¡®è®¤é€‰æ‹©</button>
                </div>
                <div class="data-op-btn">
                    <button class="data-btn export-btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button class="data-btn import-btn" onclick="document.getElementById('importFile').click()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡åŒºåŸŸ -->
        <div class="stats-section">
            <div class="stats-title" id="statsTitle">è´¦å•ç»Ÿè®¡</div>
            
            <!-- é¢„ç®—æ¨¡å— -->
            <div class="budget-section" id="budgetSection">
                <div class="budget-title">ğŸ¯ æœˆåº¦é¢„ç®—è¿›åº¦</div>
                <div id="budgetContent">
                    <!-- åŠ¨æ€ç”Ÿæˆé¢„ç®—é¡¹ -->
                </div>
            </div>
            
            <!-- å¯è§†åŒ–å›¾è¡¨åŒºåŸŸ -->
            <div class="chart-section">
                <div class="chart-item">
                    <div class="chart-title">æ”¶æ”¯è¶‹åŠ¿å›¾</div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                <div class="chart-item">
                    <div class="chart-title">æ”¶æ”¯åˆ†ç±»å æ¯”</div>
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- æ±‡æ€»æ•°æ® -->
            <div class="stats-summary">
                <div class="stats-item">
                    <div class="label">ä¸ˆå¤«æ”¯å‡º</div>
                    <div class="value expense" id="husbandExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å¦»å­æ”¯å‡º</div>
                    <div class="value expense" id="wifeExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»æ”¯å‡º</div>
                    <div class="value expense" id="totalExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»æ”¶å…¥</div>
                    <div class="value income" id="totalIncome">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»ä½™é¢</div>
                    <div class="value balance" id="totalBalance">0.00</div>
                </div>
            </div>

            <!-- æ”¯å‡ºåˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="expenseCategoryStats">
                <div class="category-title">ğŸ“ æ”¯å‡ºåˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="expenseCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¯å‡ºåˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>

            <!-- æ”¶å…¥åˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="incomeCategoryStats">
                <div class="category-title">ğŸ’° æ”¶å…¥åˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="incomeCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¶å…¥åˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>
        </div>

        <!-- è®°è´¦æ˜ç»†åŒºåŸŸ -->
        <div class="records-section">
            <!-- æ‰¹é‡æ“ä½œæ  -->
            <div class="batch-operate">
                <div class="batch-select">
                    <input type="checkbox" id="selectAll" onchange="selectAllRecords()">
                    <label for="selectAll">å…¨é€‰</label>
                    <span id="selectedCount">(0/0)</span>
                </div>
                <button class="batch-delete-btn" id="batchDeleteBtn" onclick="showBatchDeleteModal()" disabled>ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th class="checkbox-col">#</th>
                        <th>æ—¥æœŸ</th>
                        <th>è®°è´¦äºº</th>
                        <th>æ”¶æ”¯ç±»å‹</th>
                        <th>å…·ä½“åˆ†ç±»</th>
                        <th class="amount-col">é‡‘é¢</th>
                        <th>å¤‡æ³¨</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="recordsBody">
                    <!-- åŠ¨æ€æ¸²æŸ“è®°è´¦è®°å½• -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤å¼¹çª—ï¼ˆå•æ¡ï¼‰ -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-box">
            <div class="modal-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            <div class="modal-content">
                ä½ ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°è´¦è®°å½•å—ï¼Ÿ<br>åˆ é™¤åæ•°æ®å°†<strong>æ— æ³•æ¢å¤</strong>ï¼Œè¯·è°¨æ…æ“ä½œï¼
            </div>
            <div class="modal-btns">
                <button class="modal-btn cancel" onclick="hideDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmDeleteRecord()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="batchDeleteModal">
        <div class="modal-box">
            <div class="modal-title">âš ï¸ æ‰¹é‡åˆ é™¤ç¡®è®¤</div>
            <div class="modal-content">
                ä½ ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„è®°è´¦è®°å½•å—ï¼Ÿ<br>åˆ é™¤åæ•°æ®å°†<strong>æ— æ³•æ¢å¤</strong>ï¼Œè¯·è°¨æ…æ“ä½œï¼
            </div>
            <div class="modal-btns">
                <button class="modal-btn cancel" onclick="hideBatchDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmBatchDeleteRecord()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">âš™ï¸ è‡ªå®šä¹‰è®¾ç½®</div>
            <div class="close-settings" onclick="hideSettingsPanel()">âœ•</div>
        </div>
        
        <!-- è‡ªå®šä¹‰è®°è´¦äºº -->
        <div class="settings-group">
            <div class="settings-group-title">ğŸ‘¥ è‡ªå®šä¹‰è®°è´¦äºº</div>
            <div id="customUsersContainer">
                <!-- åŠ¨æ€ç”Ÿæˆè®°è´¦äººé¡¹ -->
            </div>
            <button class="add-btn" onclick="addCustomUserItem()">+ æ·»åŠ è®°è´¦äºº</button>
        </div>
        
        <!-- è‡ªå®šä¹‰æ”¯å‡ºåˆ†ç±» -->
        <div class="settings-group">
            <div class="settings-group-title">ğŸ“ è‡ªå®šä¹‰æ”¯å‡ºåˆ†ç±»</div>
            <div id="customExpenseCategoriesContainer">
                <!-- åŠ¨æ€ç”Ÿæˆæ”¯å‡ºåˆ†ç±»é¡¹ -->
            </div>
            <button class="add-btn" onclick="addCustomCategoryItem('expense')">+ æ·»åŠ æ”¯å‡ºåˆ†ç±»</button>
        </div>
        
        <!-- è‡ªå®šä¹‰æ”¶å…¥åˆ†ç±» -->
        <div class="settings-group">
            <div class="settings-group-title">ğŸ’° è‡ªå®šä¹‰æ”¶å…¥åˆ†ç±»</div>
            <div id="customIncomeCategoriesContainer">
                <!-- åŠ¨æ€ç”Ÿæˆæ”¶å…¥åˆ†ç±»é¡¹ -->
            </div>
            <button class="add-btn" onclick="addCustomCategoryItem('income')">+ æ·»åŠ æ”¶å…¥åˆ†ç±»</button>
        </div>
        
        <!-- é¢„ç®—è®¾ç½® -->
        <div class="settings-group">
            <div class="settings-group-title">ğŸ¯ æœˆåº¦é¢„ç®—è®¾ç½®</div>
            <div id="budgetSettingsContainer">
                <!-- åŠ¨æ€ç”Ÿæˆé¢„ç®—é¡¹ -->
            </div>
            <button class="add-btn" onclick="addBudgetItem()">+ æ·»åŠ é¢„ç®—é¡¹</button>
        </div>
        
        <button class="save-settings" onclick="saveCustomSettings()">ğŸ’¾ ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
    </div>

    <!-- Toastå®¹å™¨ -->
    <div class="toast" id="globalToast"></div>

    <script>
        // ========== å…¨å±€é…ç½® & å˜é‡ ==========
        const defaultConfig = {
            users: ['ä¸ˆå¤«', 'å¦»å­'],
            categories: {
                æ”¯å‡º: ['é¤é¥®', 'æœé¥°', 'ä½æˆ¿', 'äº¤é€š', 'å¨±ä¹', 'æ—¥ç”¨å“', 'åŒ»ç–—', 'è‚²å„¿', 'å…¶ä»–'],
                æ”¶å…¥: ['è–ªèµ„', 'å…¼èŒ', 'ç†è´¢', 'ç¤¼é‡‘', 'å…¶ä»–']
            },
            budgets: [] // { month: '2024-05', category: 'é¤é¥®', amount: 2000 }
        };
        // çº§è”é€‰æ‹©çŠ¶æ€ç®¡ç†
        let cascadeState = {
            selectedYear: '',
            selectedMonth: '',
            selectedDay: ''
        };
        let waitDeleteRecordId = null;
        let selectedRecordIds = [];
        let trendChartInstance = null;
        let pieChartInstance = null;
        let formState = {
            user: '',
            type: '',
            category: '',
            amount: '',
            date: '',
            remark: ''
        };
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            initConfig();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            initUserSelect();
            initUserMultiFilter();
            changeCategoryOptions();
            loadFormState();
            initCascadeOptions(); // åˆå§‹åŒ–çº§è”é€‰é¡¹
            initCustomSettingsPanel();
            loadRecords();
            initCharts();
            bindEvents();
        });

        // ========== åŸºç¡€é…ç½®ç®¡ç† ==========
        function getConfig() {
            const config = localStorage.getItem('familyAccountConfig');
            return config ? JSON.parse(config) : JSON.parse(JSON.stringify(defaultConfig));
        }

        function saveConfig(config) {
            localStorage.setItem('familyAccountConfig', JSON.stringify(config));
            initUserSelect();
            initUserMultiFilter();
            changeCategoryOptions();
        }

        function initConfig() {
            if (!localStorage.getItem('familyAccountConfig')) {
                saveConfig(defaultConfig);
            }
        }

        // ========== è¡¨å•çŠ¶æ€ä¿å­˜/åŠ è½½ ==========
        function saveFormState() {
            formState = {
                user: document.getElementById('userSelect').value,
                type: document.getElementById('typeSelect').value,
                category: document.getElementById('categorySelect').value,
                amount: document.getElementById('amountInput').value,
                date: document.getElementById('dateInput').value,
                remark: document.getElementById('remarkInput').value
            };
        }

        function loadFormState() {
            if (!formState.user) return;
            document.getElementById('userSelect').value = formState.user;
            document.getElementById('typeSelect').value = formState.type;
            document.getElementById('categorySelect').value = formState.category;
            document.getElementById('amountInput').value = formState.amount;
            document.getElementById('dateInput').value = formState.date;
            document.getElementById('remarkInput').value = formState.remark;
        }

        // ========== è®°è´¦äºº/åˆ†ç±»åˆå§‹åŒ– ==========
        function initUserSelect() {
            const userSelect = document.getElementById('userSelect');
            const config = getConfig();
            userSelect.innerHTML = '';
            config.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                userSelect.appendChild(option);
            });
            saveFormState();
        }

        function initUserMultiFilter() {
            const container = document.getElementById('userMultiFilter');
            const config = getConfig();
            container.innerHTML = '';
            config.users.forEach(user => {
                const item = document.createElement('div');
                item.className = 'user-checkbox-item';
                item.innerHTML = `
                    <input type="checkbox" id="user_${user}" value="${user}" checked>
                    <label for="user_${user}">${user}</label>
                `;
                item.querySelector('input').addEventListener('change', filterRecords);
                container.appendChild(item);
            });
        }

        function changeCategoryOptions() {
            const typeSelect = document.getElementById('typeSelect');
            const categorySelect = document.getElementById('categorySelect');
            const currentType = typeSelect.value;
            const config = getConfig();
            const categories = config.categories[currentType];

            categorySelect.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
            saveFormState();
        }

        // ========== å¿«é€Ÿå¡«å€¼ ==========
        function setQuickDate(type) {
            const date = new Date();
            if (type === 'yesterday') {
                date.setDate(date.getDate() - 1);
            }
            const dateStr = date.toISOString().split('T')[0];
            document.getElementById('dateInput').value = dateStr;
            saveFormState();
        }

        function fillRemark(text) {
            document.getElementById('remarkInput').value = text;
            saveFormState();
        }

        // ========== çº§è”æ—¶é—´é€‰æ‹©æ ¸å¿ƒé€»è¾‘ ==========
        // åˆå§‹åŒ–çº§è”é€‰é¡¹
        function initCascadeOptions() {
            renderYearOptions();
            renderMonthOptions();
            renderDayOptions();
            updateConfirmBtnState();
        }

        // æ¸²æŸ“å¹´ä»½é€‰é¡¹
        function renderYearOptions() {
            const yearOptions = document.getElementById('yearOptions');
            const records = getRecords();
            const currentYear = new Date().getFullYear();
            
            // æå–æ‰€æœ‰è®°å½•ä¸­çš„å¹´ä»½ï¼ŒåŠ ä¸Šå½“å‰å¹´ï¼Œå»é‡æ’åº
            let yearList = [currentYear];
            records.forEach(record => {
                const year = record.date.split('-')[0];
                if (!yearList.includes(parseInt(year))) {
                    yearList.push(parseInt(year));
                }
            });
            yearList = yearList.sort((a, b) => b - a); // é™åºæ’åˆ—

            // ç”Ÿæˆå¹´ä»½é€‰é¡¹
            yearOptions.innerHTML = '';
            yearList.forEach(year => {
                const option = document.createElement('div');
                option.className = `cascade-option ${cascadeState.selectedYear == year ? 'active' : ''}`;
                option.textContent = `${year}å¹´`;
                option.dataset.year = year;
                
                option.addEventListener('click', function() {
                    // æ›´æ–°é€‰ä¸­å¹´ä»½
                    cascadeState.selectedYear = this.dataset.year;
                    // é‡ç½®æœˆã€æ—¥é€‰æ‹©
                    cascadeState.selectedMonth = '';
                    cascadeState.selectedDay = '';
                    // é‡æ–°æ¸²æŸ“
                    renderYearOptions();
                    renderMonthOptions();
                    renderDayOptions();
                    updateConfirmBtnState();
                });
                
                yearOptions.appendChild(option);
            });
        }

        // æ¸²æŸ“æœˆä»½é€‰é¡¹
        function renderMonthOptions() {
            const monthOptions = document.getElementById('monthOptions');
            monthOptions.innerHTML = '';

            // æœªé€‰å¹´ä»½ï¼Œæœˆä»½å…¨éƒ¨ç¦ç”¨
            if (!cascadeState.selectedYear) {
                for (let i = 1; i <= 12; i++) {
                    const monthStr = String(i).padStart(2, '0');
                    const option = document.createElement('div');
                    option.className = 'cascade-option disabled';
                    option.textContent = `${monthStr}æœˆ`;
                    monthOptions.appendChild(option);
                }
                return;
            }

            // å·²é€‰å¹´ä»½ï¼Œç”Ÿæˆ12ä¸ªæœˆé€‰é¡¹
            for (let i = 1; i <= 12; i++) {
                const monthStr = String(i).padStart(2, '0');
                const option = document.createElement('div');
                option.className = `cascade-option ${cascadeState.selectedMonth == monthStr ? 'active' : ''}`;
                option.textContent = `${monthStr}æœˆ`;
                option.dataset.month = monthStr;
                
                option.addEventListener('click', function() {
                    // æ›´æ–°é€‰ä¸­æœˆä»½
                    cascadeState.selectedMonth = this.dataset.month;
                    // é‡ç½®æ—¥é€‰æ‹©
                    cascadeState.selectedDay = '';
                    // é‡æ–°æ¸²æŸ“
                    renderMonthOptions();
                    renderDayOptions();
                    updateConfirmBtnState();
                });
                
                monthOptions.appendChild(option);
            }
        }

        // æ¸²æŸ“æ—¥æœŸé€‰é¡¹
        function renderDayOptions() {
            const dayOptions = document.getElementById('dayOptions');
            dayOptions.innerHTML = '';

            // æœªé€‰å¹´/æœˆï¼Œæ—¥æœŸå…¨éƒ¨ç¦ç”¨
            if (!cascadeState.selectedYear || !cascadeState.selectedMonth) {
                for (let i = 1; i <= 31; i++) {
                    const dayStr = String(i).padStart(2, '0');
                    const option = document.createElement('div');
                    option.className = 'cascade-option disabled';
                    option.textContent = `${dayStr}æ—¥`;
                    dayOptions.appendChild(option);
                }
                return;
            }

            // è®¡ç®—é€‰ä¸­å¹´æœˆçš„æ€»å¤©æ•°
            const daysInMonth = new Date(cascadeState.selectedYear, cascadeState.selectedMonth, 0).getDate();
            
            // ç”Ÿæˆæ—¥æœŸé€‰é¡¹
            for (let i = 1; i <= daysInMonth; i++) {
                const dayStr = String(i).padStart(2, '0');
                const option = document.createElement('div');
                option.className = `cascade-option ${cascadeState.selectedDay == dayStr ? 'active' : ''}`;
                option.textContent = `${dayStr}æ—¥`;
                option.dataset.day = dayStr;
                
                option.addEventListener('click', function() {
                    // æ›´æ–°é€‰ä¸­æ—¥æœŸ
                    cascadeState.selectedDay = this.dataset.day;
                    // é‡æ–°æ¸²æŸ“
                    renderDayOptions();
                    updateConfirmBtnState();
                });
                
                dayOptions.appendChild(option);
            }
        }

        // æ›´æ–°ç¡®è®¤æŒ‰é’®çŠ¶æ€
        function updateConfirmBtnState() {
            const confirmBtn = document.getElementById('confirmSelectBtn');
            // å¿…é¡»é€‰å®Œå¹´ã€æœˆã€æ—¥æ‰èƒ½ç¡®è®¤
            const canConfirm = cascadeState.selectedYear && cascadeState.selectedMonth && cascadeState.selectedDay;
            confirmBtn.disabled = !canConfirm;
        }

        // å±•ç¤ºçº§è”é€‰æ‹©é¢æ¿
        function showCascadePanel() {
            document.getElementById('cascadeSelectPanel').classList.remove('hide');
        }

        // ç¡®è®¤æ—¶é—´é€‰æ‹©
        function confirmTimeSelect() {
            const { selectedYear, selectedMonth, selectedDay } = cascadeState;
            const fullDate = `${selectedYear}-${selectedMonth}-${selectedDay}`;
            
            // æ›´æ–°å±•ç¤ºæ–‡æœ¬
            document.getElementById('selectedTimeText').textContent = fullDate;
            document.getElementById('statsTitle').textContent = `ğŸ“… ${fullDate} è´¦å•ç»Ÿè®¡`;
            
            // éšè—çº§è”é€‰æ‹©é¢æ¿
            document.getElementById('cascadeSelectPanel').classList.add('hide');
            
            // æ‰§è¡Œç­›é€‰
            filterRecords();
            showToast('æ—¶é—´é€‰æ‹©æˆåŠŸï¼', 'success');
        }

        // ========== æ•°æ®CRUD ==========
        function getRecords() {
            const records = localStorage.getItem('familyAccountRecords');
            return records ? JSON.parse(records) : [];
        }

        function saveRecords(records) {
            localStorage.setItem('familyAccountRecords', JSON.stringify(records));
            // æ–°å¢/ä¿®æ”¹è®°å½•åï¼Œæ›´æ–°çº§è”å¹´ä»½é€‰é¡¹
            initCascadeOptions();
        }

        function loadRecords() {
            const records = getRecords();
            renderRecords(records);
            updateSelectedCount();
        }

        function filterRecords() {
            const records = getRecords();
            const { selectedYear, selectedMonth, selectedDay } = cascadeState;
            const selectedUsers = Array.from(document.querySelectorAll('.user-multi-filter input:checked')).map(input => input.value);
            
            // åŸºç¡€ç­›é€‰ï¼šè®°è´¦äºº
            let filtered = records.filter(record => selectedUsers.includes(record.user));
            
            // æ—¶é—´ç­›é€‰ï¼šæŒ‰é€‰ä¸­çš„å¹´/æœˆ/æ—¥
            if (selectedYear && selectedMonth && selectedDay) {
                const fullDate = `${selectedYear}-${selectedMonth}-${selectedDay}`;
                filtered = filtered.filter(record => record.date === fullDate);
            }            // åªé€‰äº†å¹´å’Œæœˆï¼ŒæŒ‰æœˆç­›é€‰
            else if (selectedYear && selectedMonth) {
                const monthPrefix = `${selectedYear}-${selectedMonth}`;
                filtered = filtered.filter(record => record.date.startsWith(monthPrefix));
            }
            // åªé€‰äº†å¹´ï¼ŒæŒ‰å¹´ç­›é€‰
            else if (selectedYear) {
                filtered = filtered.filter(record => record.date.startsWith(selectedYear));
            }
            
            renderRecords(filtered);
            calculateStats(filtered);
            renderCategoryStats(filtered);
            renderBudgetStats();
            updateCharts(filtered, selectedYear, selectedMonth, selectedDay);
            updateSelectedCount();
        }

        function renderRecords(records) {
            const tbody = document.getElementById('recordsBody');
            tbody.innerHTML = '';
            
            if (records.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <svg viewBox="0 0 24 24">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                            </svg>
                            <div class="empty-state-text">æš‚æ— è®°è´¦è®°å½•</div>
                            <div class="empty-state-tip">ç‚¹å‡»"æ·»åŠ è®°è´¦è®°å½•"å¼€å§‹è®°è´¦å§ï½</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            records.forEach(record => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="checkbox-col">
                        <input type="checkbox" class="record-checkbox" data-id="${record.id}" onchange="selectRecord(${record.id}, this.checked)">
                    </td>
                    <td>${record.date}</td>
                    <td>${record.user}</td>
                    <td>${record.type}</td>
                    <td>${record.category}</td>
                    <td class="amount-col">Â¥${record.amount.toFixed(2)}</td>
                    <td>${record.remark || '-'}</td>
                    <td class="operate-btn">
                        <span class="edit-btn" onclick="editRecord(${record.id})">ç¼–è¾‘</span>
                        <span class="delete-btn" onclick="showDeleteModal(${record.id})">åˆ é™¤</span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function addRecord() {
            const user = document.getElementById('userSelect').value;
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const date = document.getElementById('dateInput').value;
            const remark = document.getElementById('remarkInput').value.trim();
            
            if (!amount || amount <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼', 'warning');
                return;
            }
            if (!date) {
                showToast('è¯·é€‰æ‹©æ—¥æœŸï¼', 'warning');
                return;
            }
            
            const record = {
                id: Date.now(),
                user,
                type,
                category,
                amount,
                date,
                remark
            };
            
            const records = getRecords();
            records.push(record);
            saveRecords(records);
            
            clearForm();
            loadRecords();
            filterRecords();
            showToast('è®°è´¦è®°å½•æ·»åŠ æˆåŠŸï¼', 'success');
        }

        function editRecord(id) {
            const records = getRecords();
            const record = records.find(item => item.id === id);
            if (!record) return;
            
            document.getElementById('userSelect').value = record.user;
            document.getElementById('typeSelect').value = record.type;
            changeCategoryOptions();
            document.getElementById('categorySelect').value = record.category;
            document.getElementById('amountInput').value = record.amount;
            document.getElementById('dateInput').value = record.date;
            document.getElementById('remarkInput').value = record.remark;
            document.getElementById('editRecordId').value = id;
            
            document.getElementById('addRecordBtn').style.display = 'none';
            document.getElementById('editRecordBtn').style.display = 'inline-block';
            
            // æ»šåŠ¨åˆ°è¡¨å•é¡¶éƒ¨
            document.querySelector('.input-section').scrollIntoView({ behavior: 'smooth' });
        }

        function saveEditRecord() {
            const id = parseInt(document.getElementById('editRecordId').value);
            const user = document.getElementById('userSelect').value;
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const date = document.getElementById('dateInput').value;
            const remark = document.getElementById('remarkInput').value.trim();
            
            if (!amount || amount <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼', 'warning');
                return;
            }
            if (!date) {
                showToast('è¯·é€‰æ‹©æ—¥æœŸï¼', 'warning');
                return;
            }
            
            const records = getRecords();
            const index = records.findIndex(item => item.id === id);
            if (index === -1) return;
            
            records[index] = {
                ...records[index],
                user,
                type,
                category,
                amount,
                date,
                remark
            };
            
            saveRecords(records);
            
            cancelEdit();
            loadRecords();
            filterRecords();
            showToast('è®°è´¦è®°å½•ä¿®æ”¹æˆåŠŸï¼', 'success');
        }

        function cancelEdit() {
            clearForm();
            document.getElementById('editRecordId').value = '';
            document.getElementById('addRecordBtn').style.display = 'inline-block';
            document.getElementById('editRecordBtn').style.display = 'none';
        }

        function clearForm() {
            document.getElementById('amountInput').value = '';
            document.getElementById('remarkInput').value = '';
            saveFormState();
        }

        // ========== æ‰¹é‡æ“ä½œåŠŸèƒ½ ==========
        function selectAllRecords() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.record-checkbox');
            selectedRecordIds = [];
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                if (selectAll.checked) {
                    selectedRecordIds.push(parseInt(checkbox.dataset.id));
                }
            });
            
            updateSelectedCount();
            document.getElementById('batchDeleteBtn').disabled = !selectAll.checked;
        }

        function updateSelectedCount() {
            const total = document.querySelectorAll('.record-checkbox').length;
            const count = selectedRecordIds.length;
            document.getElementById('selectedCount').textContent = `(${count}/${total})`;
            document.getElementById('batchDeleteBtn').disabled = count === 0;
        }

        function selectRecord(id, isChecked) {
            if (isChecked) {
                if (!selectedRecordIds.includes(id)) selectedRecordIds.push(id);
            } else {
                selectedRecordIds = selectedRecordIds.filter(item => item !== id);
            }
            updateSelectedCount();
            
            // å–æ¶ˆå…¨é€‰
            document.getElementById('selectAll').checked = false;
        }

        function showBatchDeleteModal() {
            if (selectedRecordIds.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•ï¼', 'warning');
                return;
            }
            document.getElementById('batchDeleteModal').classList.add('show');
        }

        function hideBatchDeleteModal() {
            document.getElementById('batchDeleteModal').classList.remove('show');
        }

        function confirmBatchDeleteRecord() {
            let records = getRecords();
            records = records.filter(record => !selectedRecordIds.includes(record.id));
            saveRecords(records);
            
            selectedRecordIds = [];
            document.getElementById('selectAll').checked = false;
            updateSelectedCount();
            
            loadRecords();
            filterRecords();
            hideBatchDeleteModal();
            showToast(`æˆåŠŸåˆ é™¤${selectedRecordIds.length}æ¡è®°å½•ï¼`, 'success');
        }

        // ========== åˆ é™¤åŠŸèƒ½ ==========
        function showDeleteModal(id) {
            waitDeleteRecordId = id;
            document.getElementById('deleteModal').classList.add('show');
        }

        function hideDeleteModal() {
            waitDeleteRecordId = null;
            document.getElementById('deleteModal').classList.remove('show');
        }

        function confirmDeleteRecord() {
            if (!waitDeleteRecordId) return;
            
            const records = getRecords();
            const newRecords = records.filter(record => record.id !== waitDeleteRecordId);
            saveRecords(newRecords);
            
            loadRecords();
            filterRecords();
            hideDeleteModal();
            showToast('è®°è´¦è®°å½•åˆ é™¤æˆåŠŸï¼', 'success');
            
            waitDeleteRecordId = null;
        }

        // ========== æ•°æ®å¯¼å‡º/å¯¼å…¥ ==========
        function exportData() {
            const records = getRecords();
            const config = getConfig();
            const exportData = {
                records: records,
                config: config,
                exportTime: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å®¶åº­è®°è´¦æœ¬_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    if (importData.records) saveRecords(importData.records);
                    if (importData.config) saveConfig(importData.config);
                    
                    loadRecords();
                    filterRecords();
                    initCustomSettingsPanel();
                    initCascadeOptions(); // é‡æ–°åˆå§‹åŒ–çº§è”é€‰é¡¹
                    
                    showToast('æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                } catch (err) {
                    showToast('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥ï¼', 'warning');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ========== è‡ªå®šä¹‰è®¾ç½®é¢æ¿ ==========
        function showSettingsPanel() {
            document.getElementById('settingsPanel').classList.add('show');
            initCustomSettingsPanel();
        }

        function hideSettingsPanel() {
            document.getElementById('settingsPanel').classList.remove('show');
        }

        function initCustomSettingsPanel() {
            const config = getConfig();
            initCustomItems('customUsersContainer', config.users);
            initCustomItems('customExpenseCategoriesContainer', config.categories.æ”¯å‡º);
            initCustomItems('customIncomeCategoriesContainer', config.categories.æ”¶å…¥);
            initBudgetItems(config.budgets);
        }

        function initCustomItems(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'custom-item';
                div.innerHTML = `
                    <input type="text" value="${item}" placeholder="è¯·è¾“å…¥åç§°">
                    <div class="custom-item-btn">
                        <button class="custom-btn" style="background: #c87065;" onclick="deleteCustomItem(this)">âœ•</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addCustomUserItem() {
            const container = document.getElementById('customUsersContainer');
            const div = document.createElement('div');
            div.className = 'custom-item';
            div.innerHTML = `
                <input type="text" placeholder="è¯·è¾“å…¥è®°è´¦äººåç§°">
                <div class="custom-item-btn">
                    <button class="custom-btn" style="background: #c87065;" onclick="deleteCustomItem(this)">âœ•</button>
                </div>
            `;
            container.appendChild(div);
        }

        function addCustomCategoryItem(type) {
            const containerId = type === 'expense' ? 'customExpenseCategoriesContainer' : 'customIncomeCategoriesContainer';
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = 'custom-item';
            div.innerHTML = `
                <input type="text" placeholder="${type === 'expense' ? 'è¯·è¾“å…¥æ”¯å‡ºåˆ†ç±»' : 'è¯·è¾“å…¥æ”¶å…¥åˆ†ç±»'}">
                <div class="custom-item-btn">
                    <button class="custom-btn" style="background: #c87065;" onclick="deleteCustomItem(this)">âœ•</button>
                </div>
            `;
            container.appendChild(div);
        }

        // é¢„ç®—é¡¹åˆå§‹åŒ– & æ·»åŠ 
        function initBudgetItems(budgets) {
            const container = document.getElementById('budgetSettingsContainer');
            container.innerHTML = '';
            
            // è·å–æ‰€æœ‰æ”¯å‡ºåˆ†ç±»
            const config = getConfig();
            const expenseCategories = config.categories.æ”¯å‡º;
            
            // åˆå§‹åŒ–é¢„ç®—é¡¹ï¼ˆé»˜è®¤ç»™æ‰€æœ‰æ”¯å‡ºåˆ†ç±»åŠ é¢„ç®—é¡¹ï¼‰
            if (budgets.length === 0) {
                expenseCategories.forEach(category => {
                    addBudgetItemToContainer(container, category, 0);
                });
                return;
            }
            
            // æ¸²æŸ“å·²æœ‰é¢„ç®—é¡¹
            budgets.forEach(budget => {
                addBudgetItemToContainer(container, budget.category, budget.amount);
            });
        }

        function addBudgetItem() {
            const container = document.getElementById('budgetSettingsContainer');
            addBudgetItemToContainer(container, '', 0);
        }

        function addBudgetItemToContainer(container, category, amount) {
            const div = document.createElement('div');
            div.className = 'custom-item';
            div.innerHTML = `
                <select>
                    ${getExpenseCategoryOptions(category)}
                </select>
                <input type="number" value="${amount}" placeholder="é¢„ç®—é‡‘é¢" min="0.01" step="0.01">
                <div class="custom-item-btn">
                    <button class="custom-btn" style="background: #c87065;" onclick="deleteCustomItem(this)">âœ•</button>
                </div>
            `;
            container.appendChild(div);
        }

        function getExpenseCategoryOptions(selected) {
            const config = getConfig();
            const expenseCategories = config.categories.æ”¯å‡º;
            let options = '';
            expenseCategories.forEach(category => {
                options += `<option value="${category}" ${category === selected ? 'selected' : ''}>${category}</option>`;
            });
            return options;
        }

        // åˆ é™¤è‡ªå®šä¹‰é¡¹
        function deleteCustomItem(el) {
            const parent = el.closest('.custom-item');
            if (parent) parent.remove();
        }

        // ä¿å­˜æ‰€æœ‰è‡ªå®šä¹‰è®¾ç½®
        function saveCustomSettings() {
            const config = getConfig();
            
            // ä¿å­˜è®°è´¦äºº
            const userInputs = document.querySelectorAll('#customUsersContainer .custom-item input');
            config.users = Array.from(userInputs).map(input => input.value.trim()).filter(Boolean);
            if (config.users.length === 0) config.users = ['ä¸ˆå¤«', 'å¦»å­']; // å…œåº•
            
            // ä¿å­˜æ”¯å‡ºåˆ†ç±»
            const expenseInputs = document.querySelectorAll('#customExpenseCategoriesContainer .custom-item input');
            config.categories.æ”¯å‡º = Array.from(expenseInputs).map(input => input.value.trim()).filter(Boolean);
            if (config.categories.æ”¯å‡º.length === 0) config.categories.æ”¯å‡º = ['é¤é¥®', 'æœé¥°', 'ä½æˆ¿', 'äº¤é€š']; // å…œåº•
            
            // ä¿å­˜æ”¶å…¥åˆ†ç±»
            const incomeInputs = document.querySelectorAll('#customIncomeCategoriesContainer .custom-item input');
            config.categories.æ”¶å…¥ = Array.from(incomeInputs).map(input => input.value.trim()).filter(Boolean);
            if (config.categories.æ”¶å…¥.length === 0) config.categories.æ”¶å…¥ = ['è–ªèµ„', 'å…¼èŒ', 'ç†è´¢']; // å…œåº•
            
            // ä¿å­˜é¢„ç®—è®¾ç½®
            const budgetItems = document.querySelectorAll('#budgetSettingsContainer .custom-item');
            const currentMonth = new Date().toISOString().split('-').slice(0, 2).join('-'); // å½“å‰æœˆä»½ yyyy-mm
            config.budgets = Array.from(budgetItems).map(item => {
                const category = item.querySelector('select').value;
                const amount = parseFloat(item.querySelector('input').value) || 0;
                return { month: currentMonth, category, amount };
            }).filter(budget => budget.amount > 0);
            
            // ä¿å­˜é…ç½®
            saveConfig(config);
            
            // åˆ·æ–°é¡µé¢çŠ¶æ€
            initUserSelect();
            initUserMultiFilter();
            changeCategoryOptions();
            filterRecords();
            
            hideSettingsPanel();
            showToast('è‡ªå®šä¹‰è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'success');
        }

        // ========== ç»Ÿè®¡è®¡ç®—åŠŸèƒ½ ==========
        function calculateStats(records) {
            // åˆå§‹åŒ–ç»Ÿè®¡å€¼
            let husbandExpense = 0, wifeExpense = 0, totalExpense = 0, totalIncome = 0;
            
            // æŒ‰è®°è´¦äºº/ç±»å‹ç»Ÿè®¡
            records.forEach(record => {
                if (record.type === 'æ”¯å‡º') {
                    totalExpense += record.amount;
                    if (record.user === 'ä¸ˆå¤«') husbandExpense += record.amount;
                    if (record.user === 'å¦»å­') wifeExpense += record.amount;
                } else {
                    totalIncome += record.amount;
                }
            });
            
            // è®¡ç®—ä½™é¢
            const totalBalance = totalIncome - totalExpense;
            
            // æ›´æ–°DOM
            document.getElementById('husbandExpense').textContent = husbandExpense.toFixed(2);
            document.getElementById('wifeExpense').textContent = wifeExpense.toFixed(2);
            document.getElementById('totalExpense').textContent = totalExpense.toFixed(2);
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
            document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);
        }

        // åˆ†ç±»æ˜ç»†ç»Ÿè®¡
        function renderCategoryStats(records) {
            // æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡
            const expenseCategoryMap = {};
            // æ”¶å…¥åˆ†ç±»ç»Ÿè®¡
            const incomeCategoryMap = {};
            
            // åˆå§‹åŒ–åˆ†ç±»
            const config = getConfig();
            config.categories.æ”¯å‡º.forEach(cat => expenseCategoryMap[cat] = 0);
            config.categories.æ”¶å…¥.forEach(cat => incomeCategoryMap[cat] = 0);
            
            // ç´¯åŠ é‡‘é¢
            records.forEach(record => {
                if (record.type === 'æ”¯å‡º') {
                    expenseCategoryMap[record.category] = (expenseCategoryMap[record.category] || 0) + record.amount;
                } else {
                    incomeCategoryMap[record.category] = (incomeCategoryMap[record.category] || 0) + record.amount;
                }
            });
            
            // æ¸²æŸ“æ”¯å‡ºåˆ†ç±»
            const expenseGrid = document.getElementById('expenseCategoryGrid');
            expenseGrid.innerHTML = '';
            Object.entries(expenseCategoryMap).forEach(([cat, amount]) => {
                if (amount <= 0) return; // éšè—0é‡‘é¢åˆ†ç±»
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="name">${cat}</div>
                    <div class="value expense">Â¥${amount.toFixed(2)}</div>
                `;
                expenseGrid.appendChild(item);
            });
            
            // æ¸²æŸ“æ”¶å…¥åˆ†ç±»
            const incomeGrid = document.getElementById('incomeCategoryGrid');
            incomeGrid.innerHTML = '';
            Object.entries(incomeCategoryMap).forEach(([cat, amount]) => {
                if (amount <= 0) return; // éšè—0é‡‘é¢åˆ†ç±»
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="name">${cat}</div>
                    <div class="value income">Â¥${amount.toFixed(2)}</div>
                `;
                incomeGrid.appendChild(item);
            });
        }

        // é¢„ç®—è¿›åº¦ç»Ÿè®¡
        function renderBudgetStats() {
            const config = getConfig();
            const records = getRecords();
            const currentMonth = new Date().toISOString().split('-').slice(0, 2).join('-');
            const budgetContent = document.getElementById('budgetContent');
            
            budgetContent.innerHTML = '';
            
            // è¿‡æ»¤å½“æœˆé¢„ç®—
            const monthBudgets = config.budgets.filter(b => b.month === currentMonth);
            if (monthBudgets.length === 0) {
                budgetContent.innerHTML = '<div style="text-align: center; color: #8a8a86; padding: 10px 0;">æš‚æ— é¢„ç®—è®¾ç½®ï¼Œå‰å¾€âš™ï¸è®¾ç½®é¢æ¿æ·»åŠ </div>';
                return;
            }
            
            // è®¡ç®—å½“æœˆå„åˆ†ç±»æ”¯å‡º
            const monthExpenseMap = {};
            records.forEach(record => {
                if (record.type === 'æ”¯å‡º' && record.date.startsWith(currentMonth)) {
                    monthExpenseMap[record.category] = (monthExpenseMap[record.category] || 0) + record.amount;
                }
            });
            
            // æ¸²æŸ“é¢„ç®—é¡¹
            monthBudgets.forEach(budget => {
                const spent = monthExpenseMap[budget.category] || 0;
                const percent = budget.amount > 0 ? (spent / budget.amount) * 100 : 0;
                
                const budgetItem = document.createElement('div');
                budgetItem.className = 'budget-item';
                budgetItem.innerHTML = `
                    <div class="budget-item-header">
                        <div class="budget-category">${budget.category}</div>
                        <div class="budget-value">å·²èŠ± Â¥${spent.toFixed(2)} / é¢„ç®— Â¥${budget.amount.toFixed(2)}</div>
                    </div>
                    <div class="budget-progress">
                        <div class="budget-progress-bar ${percent > 100 ? 'over' : ''}" style="width: ${Math.min(percent, 100)}%"></div>
                    </div>
                `;
                budgetContent.appendChild(budgetItem);
            });
        }

        // ========== å›¾è¡¨å¯è§†åŒ–åŠŸèƒ½ ==========
        function initCharts() {
            // åˆå§‹åŒ–è¶‹åŠ¿å›¾
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChartInstance = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'æ”¯å‡º',
                            data: [],
                            borderColor: '#d49667',
                            backgroundColor: 'rgba(212, 150, 103, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'æ”¶å…¥',
                            data: [],
                            borderColor: '#7a9d7a',
                            backgroundColor: 'rgba(122, 157, 122, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: v => `Â¥${v}` } }
                    },
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `Â¥${ctx.raw.toFixed(2)}` } }
                    }
                }
            });

            // åˆå§‹åŒ–é¥¼å›¾
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            pieChartInstance = new Chart(pieCtx, {
                type: 'doughnut',
                data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: { callbacks: { label: (ctx) => `${ctx.label}: Â¥${ctx.raw.toFixed(2)}` } }
                    }
                }
            });
        }

        function updateCharts(records, selectedYear, selectedMonth, selectedDay) {
            // æ›´æ–°è¶‹åŠ¿å›¾ï¼ˆæ ¹æ®é€‰æ‹©çš„ç»´åº¦è°ƒæ•´ï¼‰
            updateTrendChart(records, selectedYear, selectedMonth, selectedDay);
            // æ›´æ–°é¥¼å›¾
            updatePieChart(records);
        }

        function updateTrendChart(records, selectedYear, selectedMonth, selectedDay) {
            // æ ¹æ®é€‰æ‹©çš„æ—¶é—´ç»´åº¦ç¡®å®šåˆ†ç»„æ–¹å¼
            const groupMap = {};
            
            // ç¡®å®šåˆ†ç»„ç»´åº¦
            let groupBy = 'year';
            if (selectedYear && selectedMonth && selectedDay) groupBy = 'day';
            else if (selectedYear && selectedMonth) groupBy = 'month';
            else if (selectedYear) groupBy = 'year';
            
            // æŒ‰ç»´åº¦åˆ†ç»„
            records.forEach(record => {
                let key = '';
                if (groupBy === 'day') key = record.date;
                else if (groupBy === 'month') key = record.date.split('-').slice(0, 2).join('-');
                else key = record.date.split('-')[0];
                
                if (!groupMap[key]) groupMap[key] = { expense: 0, income: 0 };
                if (record.type === 'æ”¯å‡º') groupMap[key].expense += record.amount;
                else groupMap[key].income += record.amount;
            });

            // æ’åºå¹¶æå–æ•°æ®
            const sortedKeys = Object.keys(groupMap).sort();
            const expenseData = sortedKeys.map(k => groupMap[k].expense);
            const incomeData = sortedKeys.map(k => groupMap[k].income);

            // æ›´æ–°å›¾è¡¨
            trendChartInstance.data.labels = sortedKeys;
            trendChartInstance.data.datasets[0].data = expenseData;
            trendChartInstance.data.datasets[1].data = incomeData;
            trendChartInstance.update();
        }

        function updatePieChart(records) {
            // æŒ‰åˆ†ç±»ç»Ÿè®¡æ”¯å‡ºï¼ˆé¥¼å›¾åªå±•ç¤ºæ”¯å‡ºå æ¯”ï¼‰
            const categoryMap = {};
            records.filter(r => r.type === 'æ”¯å‡º').forEach(record => {
                categoryMap[record.category] = (categoryMap[record.category] || 0) + record.amount;
            });

            // è®¡ç®—å æ¯”
            const total = Object.values(categoryMap).reduce((a, b) => a + b, 0);
            const labels = Object.keys(categoryMap);
            const values = labels.map(cat => categoryMap[cat]);

            // é…è‰²æ–¹æ¡ˆ
            const colors = ['#c87065', '#d49667', '#7a9d7a', '#5c8a8a', '#8a8a86', '#b46056', '#6a8d6a', '#4c7a7a'];

            // æ›´æ–°å›¾è¡¨
            pieChartInstance.data.labels = labels;
            pieChartInstance.data.datasets[0].data = values;
            pieChartInstance.data.datasets[0].backgroundColor = labels.map((_, i) => colors[i % colors.length]);
            pieChartInstance.update();
        }

        // ========== å…¨å±€æç¤ºåŠŸèƒ½ ==========
        function showToast(text, type = 'info') {
            const toast = document.getElementById('globalToast');
            toast.textContent = text;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            clearTimeout(toast.timer);
            toast.timer = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ========== äº‹ä»¶ç»‘å®š ==========
        function bindEvents() {
            // æ·»åŠ è®°å½•æŒ‰é’®
            document.getElementById('addRecordBtn').addEventListener('click', addRecord);
            // ä¿å­˜ä¿®æ”¹æŒ‰é’®
            document.getElementById('editRecordBtn').addEventListener('click', saveEditRecord);
            // ç›‘å¬è¡¨å•è¾“å…¥ï¼Œä¿å­˜çŠ¶æ€
            ['userSelect', 'typeSelect', 'categorySelect', 'amountInput', 'dateInput', 'remarkInput'].forEach(id => {
                document.getElementById(id).addEventListener('input', saveFormState);
            });
        }
    </script>
</body>
</html>
