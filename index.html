<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家庭记账本（完整无截断版）</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "微软雅黑", sans-serif; }
        body { max-width: 1000px; margin: 20px auto; padding: 0 10px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #e63946; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .form-group label { width: 80px; text-align: right; }
        .form-group input, .form-group select { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .form-group button { padding: 8px 20px; background: #e63946; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .stats { margin: 20px 0; padding: 15px; background: #f8f8f8; border-radius: 4px; }
        .stats div { margin: 5px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f8f8; }
        .operate { color: #e63946; cursor: pointer; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: #333; color: white; border-radius: 4px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>家庭记账本</h1>
        
        <!-- 录入区域 -->
        <div class="form-group">
            <label>记账人：</label>
            <select id="user">
                <option value="丈夫">丈夫</option>
                <option value="妻子">妻子</option>
            </select>
        </div>
        <div class="form-group">
            <label>收支类型：</label>
            <select id="type">
                <option value="支出">支出</option>
                <option value="收入">收入</option>
            </select>
        </div>
        <div class="form-group">
            <label>分类：</label>
            <select id="category">
                <option value="餐饮">餐饮</option>
                <option value="交通">交通</option>
                <option value="薪资">薪资</option>
                <option value="其他">其他</option>
            </select>
        </div>
        <div class="form-group">
            <label>金额：</label>
            <input type="number" id="amount" placeholder="请输入金额" min="0.01" step="0.01">
        </div>
        <div class="form-group">
            <label>日期：</label>
            <input type="date" id="date">
        </div>
        <div class="form-group">
            <label>备注：</label>
            <input type="text" id="remark" placeholder="可选">
        </div>
        <div class="form-group" style="justify-content: center;">
            <button onclick="addRecord()">添加记录</button>
            <button onclick="exportData()" style="background: #2a9d8f; margin-left: 10px;">导出数据</button>
        </div>

        <!-- 统计区域 -->
        <div class="stats">
            <div><strong>总支出：</strong><span id="totalExpense">0.00</span> 元</div>
            <div><strong>总收入：</strong><span id="totalIncome">0.00</span> 元</div>
            <div><strong>余额：</strong><span id="balance">0.00</span> 元</div>
        </div>

        <!-- 记录列表 -->
        <table>
            <thead>
                <tr>
                    <th>日期</th>
                    <th>记账人</th>
                    <th>类型</th>
                    <th>分类</th>
                    <th>金额</th>
                    <th>备注</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="recordList">
                <!-- 动态渲染记录 -->
            </tbody>
        </table>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // 初始化日期为今日
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // 存储数据
        let records = JSON.parse(localStorage.getItem('familyRecords')) || [];
        
        // 页面加载时渲染数据
        window.onload = function() {
            renderRecords();
            calculateStats();
        };

        // 添加记录
        function addRecord() {
            const user = document.getElementById('user').value;
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;
            const remark = document.getElementById('remark').value;

            if (!amount || amount <= 0) {
                showToast('请输入有效的金额！');
                return;
            }

            const record = {
                id: Date.now(),
                user,
                type,
                category,
                amount,
                date,
                remark
            };

            records.push(record);
            localStorage.setItem('familyRecords', JSON.stringify(records));
            
            renderRecords();
            calculateStats();
            clearForm();
            showToast('添加成功！');
        }

        // 渲染记录列表
        function renderRecords() {
            const recordList = document.getElementById('recordList');
            recordList.innerHTML = '';

            if (records.length === 0) {
                recordList.innerHTML = '<tr><td colspan="7" style="text-align: center;">暂无记录</td></tr>';
                return;
            }

            records.forEach(record => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.user}</td>
                    <td>${record.type}</td>
                    <td>${record.category}</td>
                    <td>${record.amount.toFixed(2)}</td>
                    <td>${record.remark || '-'}</td>
                    <td class="operate" onclick="deleteRecord(${record.id})">删除</td>
                `;
                recordList.appendChild(tr);
            });
        }

        // 计算统计数据
        function calculateStats() {
            let totalExpense = 0;
            let totalIncome = 0;

            records.forEach(record => {
                if (record.type === '支出') {
                    totalExpense += record.amount;
                } else {
                    totalIncome += record.amount;
                }
            });

            const balance = totalIncome - totalExpense;

            document.getElementById('totalExpense').textContent = totalExpense.toFixed(2);
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
            document.getElementById('balance').textContent = balance.toFixed(2);
        }

        // 删除记录
        function deleteRecord(id) {
            if (confirm('确定要删除这条记录吗？')) {
                records = records.filter(record => record.id !== id);
                localStorage.setItem('familyRecords', JSON.stringify(records));
                renderRecords();
                calculateStats();
                showToast('删除成功！');
            }
        }

        // 清空表单
        function clearForm() {
            document.getElementById('amount').value = '';
            document.getElementById('remark').value = '';
        }

        // 导出数据
        function exportData() {
            const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `家庭记账本_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            a.click();
            showToast('导出成功！');
        }

        // 提示框
        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.textContent = text;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }
    </script>
</body>
</html>
