<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©é¦¨å®¶åº­è®°è´¦æœ¬</title>
    <style>
        /* å…¨å±€æ ·å¼ - é«˜çº§è´¨æ„Ÿé£æ ¼æ ¸å¿ƒè°ƒæ•´ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* å­—ä½“ä¼˜åŒ–ï¼šæ›´é«˜çº§çš„æ— è¡¬çº¿å­—ä½“ç»„åˆï¼Œå¢å¼ºè´¨æ„Ÿ */
            font-family: "Inter", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            /* ä¸»æ–‡å­—è‰²ï¼šä½é¥±å’Œæ·±ç°ï¼Œæ›¿ä»£åŸ#555ï¼Œæ›´é«˜çº§ä¸åˆºçœ¼ */
            color: #4a4a48; 
            font-weight: 400;
        }
        body {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            /* èƒŒæ™¯è‰²ï¼šä½é¥±å’Œæµ…ç°ç±³è‰²ï¼Œæ›¿ä»£åŸæµ…ç±³è‰²#f9f6f0ï¼Œé«˜çº§æ„Ÿæ‹‰æ»¡ */
            background-color: #f5f2ed; 
            min-height: 100vh;
            /* è½»å¾®èƒŒæ™¯è‚Œç†ï¼Œå¢å¼ºè´¨æ„Ÿï¼ˆå¯é€‰ï¼Œå¯åˆ é™¤ï¼‰ */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d9d6d0' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .container {
            /* ä¸»ä½“èƒŒæ™¯ï¼šçº¯å‡€ç™½ï¼Œæ›¿ä»£åŸæµ…æš–åº•è‰²#fff8f0ï¼Œæ›´å¹²å‡€é«˜çº§ */
            background: #ffffff; 
            padding: 30px;
            border-radius: 16px; /* é€‚åº¦åœ†è§’ï¼Œæ¯”åŸ20pxæ›´å…‹åˆ¶ï¼Œé«˜çº§æ„Ÿ */
            box-shadow: 0 8px 24px rgba(150, 140, 130, 0.06); /* ä½é¥±å’ŒæŸ”å’Œé˜´å½±ï¼Œæ›¿ä»£åŸæš–è‰²è°ƒé˜´å½± */
            border: 1px solid rgba(233, 230, 225, 0.6); /* æç»†è¾¹æ¡†ï¼Œå¢å¼ºè´¨æ„Ÿ */
        }
        h1 {
            text-align: center;
            /* ä¸»è‰²è°ƒï¼šä½é¥±å’Œèµ¤é™¶è‰²ï¼Œæ›¿ä»£åŸæš–çº¢#e85a4fï¼Œé«˜çº§ä¸å¼ æ‰¬ */
            color: #c87065; 
            margin-bottom: 30px;
            letter-spacing: 2px; /* å­—é—´è·æ›´å…‹åˆ¶ï¼ŒåŸ3px */
            font-weight: 500; /* å­—ä½“ç²—ç»†æ›´æŸ”å’Œï¼ŒåŸ600 */
            font-size: 22px;
        }

        /* å½•å…¥åŒºåŸŸæ ·å¼ */
        .input-section {
            border-bottom: 1px solid #e9e6e1; /* ä½é¥±å’Œæµ…ç°è¾¹æ¡†ï¼Œæ›¿ä»£åŸæµ…æ£•#f0e6d2 */
            padding-bottom: 25px;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .form-group label {
            width: 80px;
            /* æ ‡ç­¾æ–‡å­—è‰²ï¼šä½é¥±å’Œä¸­ç°ï¼Œæ›¿ä»£åŸ#666 */
            color: #5c5c59; 
            font-weight: 500;
            flex-shrink: 0;
        }
        .form-group select, 
        .form-group input, 
        .form-group textarea {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            /* è¾“å…¥æ¡†è¾¹æ¡†ï¼šä½é¥±å’Œæµ…ç°ï¼Œæ›¿ä»£åŸ#e0d8c8 */
            border: 1px solid #e9e6e1; 
            border-radius: 10px; /* åœ†è§’æ›´å…‹åˆ¶ï¼ŒåŸ12px */
            font-size: 14px;
            background: #ffffff;
            transition: all 0.3s ease; /* è¿‡æ¸¡æ›´ä¸æ»‘ */
        }
        .form-group select:focus, 
        .form-group input:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #c87065; /* èšç„¦è‰²åŒæ­¥ä¸»è‰²è°ƒ */
            box-shadow: 0 0 0 3px rgba(200, 112, 101, 0.08); /* ä½é¥±å’Œèšç„¦é˜´å½±ï¼Œæ›´é«˜çº§ */
        }
        .form-group button {
            background: #c87065; /* æŒ‰é’®è‰²åŒæ­¥ä¸»è‰²è°ƒ */
            color: white !important;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .form-group button:hover {
            background: #b46056; /* hoverè‰²æ›´æš—ä¸€ç‚¹ï¼Œè¿‡æ¸¡è‡ªç„¶ */
        }

        /* ç­›é€‰åŒºåŸŸ */
        .filter-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04); /* æ›´æŸ”å’Œçš„é˜´å½± */
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border: 1px solid #e9e6e1; /* ç»†è¾¹æ¡†å¢å¼ºè´¨æ„Ÿ */
        }
        .filter-section label {
            font-weight: 500;
            color: #5c5c59; /* åŒæ­¥æ ‡ç­¾è‰² */
            flex-shrink: 0;
        }
        .filter-section select, .filter-section input {
            padding: 10px 12px;
            border: 1px solid #e9e6e1;
            border-radius: 8px;
            flex: 1;
            min-width: 150px;
            transition: border 0.3s ease;
        }
        .filter-section select:focus, .filter-section input:focus {
            border-color: #c87065;
            outline: none;
        }
        .filter-section button {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .filter-section button:hover {
            background: #b46056;
        }

        /* ç»Ÿè®¡åŒºåŸŸ */
        .stats-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            border: 1px solid #e9e6e1;
        }
        .stats-title {
            font-weight: 500;
            color: #c87065; /* åŒæ­¥ä¸»è‰²è°ƒ */
            margin-bottom: 15px;
            font-size: 16px;
        }
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stats-item {
            padding: 15px;
            /* ç»Ÿè®¡å¡ç‰‡èƒŒæ™¯ï¼šææµ…ç°ï¼Œæ›¿ä»£åŸ#fff8f0 */
            background: #f8f6f3; 
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s ease;
            border: 1px solid #e9e6e1;
        }
        .stats-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.08); /* hoveré˜´å½±æ›´æŸ”å’Œ */
        }
        .stats-item .label {
            font-size: 13px;
            /* æ¬¡è¦æ–‡å­—è‰²ï¼šä½é¥±å’Œæµ…ç°ï¼Œæ›¿ä»£åŸ#777 */
            color: #8a8a86; 
            margin-bottom: 8px;
            font-weight: 400;
        }
        .stats-item .value {
            font-size: 18px;
            font-weight: 500;
        }
        /* æ”¶æ”¯é¢œè‰²è°ƒæ•´ï¼šä½é¥±å’Œè«å…°è¿ªè‰²ç³»ï¼Œæ›¿ä»£åŸé«˜é¥±å’Œè‰² */
        .expense {
            color: #d49667; /* ç„¦ç³–è‰²ï¼Œæ›¿ä»£åŸæš–æ©™#f39c12 */
        }
        .income {
            color: #7a9d7a; /* é¼ å°¾è‰ç»¿ï¼Œæ›¿ä»£åŸæ¸…æ–°ç»¿#27ae60 */
        }
        .balance {
            color: #c87065; /* åŒæ­¥ä¸»è‰²è°ƒ */
        }

        /* åˆ†ç±»æ˜ç»†ç»Ÿè®¡ */
        .category-stats {
            margin-top: 20px;
        }
        .category-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #5c5c59; /* åŒæ­¥æ ‡ç­¾è‰² */
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        .category-item {
            padding: 10px;
            background: #f8f6f3;
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid #e9e6e1;
        }
        .category-item .name {
            color: #8a8a86; /* åŒæ­¥æ¬¡è¦æ–‡å­—è‰² */
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* æ˜ç»†åŒºåŸŸ */
        .records-section {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            overflow: hidden;
            border: 1px solid #e9e6e1;
        }
        .records-section table {
            width: 100%;
            border-collapse: collapse;
        }
        .records-section th, .records-section td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9e6e1;
        }
        .records-section th {
            background: #f8f6f3;
            color: #5c5c59;
            font-weight: 500;
            font-size: 14px;
        }
        .records-section tr:hover {
            /* hoverèƒŒæ™¯ï¼šææµ…ç°ï¼Œæ›¿ä»£åŸ#fef9f3 */
            background: #faf9f7; 
        }
        .delete-btn {
            color: #c87065;
            cursor: pointer;
            font-size: 13px;
            transition: color 0.3s ease;
        }
        .delete-btn:hover {
            color: #b46056;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 12px;
            }
            .form-group {
                gap: 10px;
            }
            .form-group label {
                width: 70px;
            }
            .stats-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ æ¸©é¦¨å®¶åº­è®°è´¦æœ¬</h1>
        
        <!-- è®°è´¦å½•å…¥åŒºåŸŸ -->
        <div class="input-section">
            <div class="form-group">
                <label>è®°è´¦äººï¼š</label>
                <select id="userSelect">
                    <option value="ä¸ˆå¤«">ä¸ˆå¤«</option>
                    <option value="å¦»å­">å¦»å­</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ”¶æ”¯ç±»å‹ï¼š</label>
                <select id="typeSelect" onchange="changeCategoryOptions()">
                    <option value="æ”¯å‡º">æ”¯å‡º</option>
                    <option value="æ”¶å…¥">æ”¶å…¥</option>
                </select>
            </div>
            <div class="form-group">
                <label>å…·ä½“åˆ†ç±»ï¼š</label>
                <select id="categorySelect">
                    <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»é€‰é¡¹ -->
                </select>
            </div>
            <div class="form-group">
                <label>é‡‘é¢ï¼š</label>
                <input type="number" id="amountInput" placeholder="è¯·è¾“å…¥é‡‘é¢" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸï¼š</label>
                <input type="date" id="dateInput">
            </div>
            <div class="form-group">
                <label>å¤‡æ³¨ï¼š</label>
                <textarea id="remarkInput" placeholder="è®°å½•æ¶ˆè´¹/æ”¶å…¥åŸå› ï¼ˆå¯é€‰ï¼‰"></textarea>
            </div>
            <div class="form-group">
                <button id="addRecordBtn">âœ¨ æ·»åŠ è®°è´¦è®°å½•</button>
            </div>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="filter-section">
            <label>æŸ¥çœ‹ç»´åº¦ï¼š</label>
            <select id="viewDimension" onchange="changeFilterPlaceholder()">
                <option value="day">æŒ‰æ—¥æŸ¥çœ‹</option>
                <option value="month">æŒ‰æœˆæŸ¥çœ‹</option>
                <option value="year">æŒ‰å¹´æŸ¥çœ‹</option>
            </select>
            <input type="text" id="filterDate" placeholder="YYYY-MM-DD" value="">
            <button id="filterBtn">ğŸ” æŸ¥è¯¢</button>
        </div>

        <!-- ç»Ÿè®¡åŒºåŸŸ -->
        <div class="stats-section">
            <div class="stats-title" id="statsTitle">å½“æ—¥ç»Ÿè®¡ï¼ˆé»˜è®¤ä»Šæ—¥ï¼‰</div>
            
            <!-- æ±‡æ€»æ•°æ® -->
            <div class="stats-summary">
                <div class="stats-item">
                    <div class="label">ä¸ˆå¤«æ”¯å‡º</div>
                    <div class="value expense" id="husbandExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å¦»å­æ”¯å‡º</div>
                    <div class="value expense" id="wifeExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»æ”¶å…¥</div>
                    <div class="value income" id="totalIncome">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»ä½™é¢</div>
                    <div class="value balance" id="totalBalance">0.00</div>
                </div>
            </div>

            <!-- æ”¯å‡ºåˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="expenseCategoryStats">
                <div class="category-title">ğŸ“ æ”¯å‡ºåˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="expenseCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¯å‡ºåˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>

            <!-- æ”¶å…¥åˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="incomeCategoryStats">
                <div class="category-title">ğŸ’° æ”¶å…¥åˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="incomeCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¶å…¥åˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>
        </div>

        <!-- è®°è´¦æ˜ç»†åŒºåŸŸ -->
        <div class="records-section">
            <table>
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>è®°è´¦äºº</th>
                        <th>æ”¶æ”¯ç±»å‹</th>
                        <th>å…·ä½“åˆ†ç±»</th>
                        <th>é‡‘é¢</th>
                        <th>å¤‡æ³¨</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="recordsBody">
                    <!-- åŠ¨æ€æ¸²æŸ“è®°è´¦è®°å½• -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // å®šä¹‰å¤šçº§åˆ†ç±»æ•°æ®ï¼ˆå¯è‡ªè¡Œæ‰©å±•ï¼‰
        const categoryData = {
            æ”¯å‡º: ['é¤é¥®', 'æœé¥°', 'ä½æˆ¿', 'äº¤é€š', 'å¨±ä¹', 'æ—¥ç”¨å“', 'åŒ»ç–—', 'è‚²å„¿', 'å…¶ä»–'],
            æ”¶å…¥: ['è–ªèµ„', 'å…¼èŒ', 'ç†è´¢', 'ç¤¼é‡‘', 'å…¶ä»–']
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            document.getElementById('filterDate').value = today;
            
            // åˆå§‹åŒ–åˆ†ç±»é€‰é¡¹
            changeCategoryOptions();
            // åˆå§‹åŒ–ç­›é€‰æ¡†æç¤ºæ–‡å­—
            changeFilterPlaceholder();
            // åŠ è½½æœ¬åœ°æ•°æ®
            loadRecords();
            // åˆå§‹åŒ–ç»Ÿè®¡
            filterRecords();

            // ç»‘å®šæ·»åŠ è®°å½•æŒ‰é’®äº‹ä»¶
            document.getElementById('addRecordBtn').addEventListener('click', addRecord);
            // ç»‘å®šç­›é€‰æŒ‰é’®äº‹ä»¶
            document.getElementById('filterBtn').addEventListener('click', filterRecords);
        });

        // 1. åˆ‡æ¢æ”¶æ”¯ç±»å‹æ—¶ï¼Œæ›´æ–°å…·ä½“åˆ†ç±»é€‰é¡¹
        function changeCategoryOptions() {
            const typeSelect = document.getElementById('typeSelect');
            const categorySelect = document.getElementById('categorySelect');
            const currentType = typeSelect.value;
            const categories = categoryData[currentType];

            // æ¸…ç©ºåŸæœ‰é€‰é¡¹
            categorySelect.innerHTML = '';
            // ç”Ÿæˆæ–°é€‰é¡¹
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // 2. åˆ‡æ¢æŸ¥çœ‹ç»´åº¦æ—¶ï¼Œæ›´æ–°ç­›é€‰æ¡†æç¤º
        function changeFilterPlaceholder() {
            const dimension = document.getElementById('viewDimension').value;
            const filterDateInput = document.getElementById('filterDate');
            const statsTitle = document.getElementById('statsTitle');
            const today = new Date();

            if (dimension === 'day') {
                filterDateInput.placeholder = 'YYYY-MM-DD';
                filterDateInput.value = today.toISOString().split('T')[0];
                statsTitle.textContent = 'ğŸ“… å½“æ—¥ç»Ÿè®¡ï¼ˆé»˜è®¤ä»Šæ—¥ï¼‰';
            } else if (dimension === 'month') {
                filterDateInput.placeholder = 'YYYY-MM';
                filterDateInput.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                statsTitle.textContent = 'ğŸ“† å½“æœˆç»Ÿè®¡';
            } else if (dimension === 'year') {
                filterDateInput.placeholder = 'YYYY';
                filterDateInput.value = today.getFullYear();
                statsTitle.textContent = 'ğŸ“ˆ å½“å¹´ç»Ÿè®¡';
            }
        }

        // 3. æœ¬åœ°å­˜å‚¨æ“ä½œ - è·å–æ‰€æœ‰è®°å½•
        function getRecords() {
            const records = localStorage.getItem('familyAccountRecords');
            return records ? JSON.parse(records) : [];
        }

        // 4. æœ¬åœ°å­˜å‚¨æ“ä½œ - ä¿å­˜è®°å½•
        function saveRecords(records) {
            localStorage.setItem('familyAccountRecords', JSON.stringify(records));
        }

        // 5. æ·»åŠ è®°è´¦è®°å½•
        function addRecord() {
            // è·å–è¡¨å•æ•°æ®
            const user = document.getElementById('userSelect').value;
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const date = document.getElementById('dateInput').value;
            const remark = document.getElementById('remarkInput').value.trim();

            // è¡¨å•éªŒè¯
            if (!amount || isNaN(amount) || amount <= 0) {
                alert('ğŸ’¡ è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï¼');
                return;
            }
            if (!date) {
                alert('ğŸ’¡ è¯·é€‰æ‹©è®°è´¦æ—¥æœŸï¼');
                return;
            }

            // åˆ›å»ºæ–°è®°å½•ï¼ˆåŒ…å«å…·ä½“åˆ†ç±»ï¼‰
            const newRecord = {
                id: Date.now(), // æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                user: user,
                type: type,
                category: category,
                amount: amount,
                date: date,
                remark: remark
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const records = getRecords();
            records.push(newRecord);
            saveRecords(records);

            // é‡ç½®è¡¨å•
            document.getElementById('amountInput').value = '';
            document.getElementById('remarkInput').value = '';

            // é‡æ–°åŠ è½½æ•°æ®å’Œç»Ÿè®¡
            loadRecords();
            filterRecords();
            alert('ğŸ‰ è®°è´¦æˆåŠŸï¼');
        }

        // 6. åŠ è½½å¹¶æ¸²æŸ“è®°è´¦æ˜ç»†
        function loadRecords(filteredRecords = null) {
            const records = filteredRecords || getRecords();
            const recordsBody = document.getElementById('recordsBody');
            recordsBody.innerHTML = '';

            // å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
            const reversedRecords = [...records].reverse();
            reversedRecords.forEach(record => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.user}</td>
                    <td>${record.type}</td>
                    <td>${record.category}</td>
                    <td>${record.amount.toFixed(2)}</td>
                    <td>${record.remark || '-'}</td>
                    <td class="delete-btn" onclick="deleteRecord(${record.id})">åˆ é™¤</td>
                `;
                recordsBody.appendChild(tr);
            });
        }

        // 7. åˆ é™¤è®°è´¦è®°å½•
        function deleteRecord(id) {
            if (confirm('âš ï¸ ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤å“¦ï½')) {
                let records = getRecords();
                records = records.filter(record => record.id !== id);
                saveRecords(records);
                loadRecords();
                filterRecords();
                alert('ğŸ—‘ï¸ è®°å½•å·²åˆ é™¤ï¼');
            }
        }

        // 8. ç­›é€‰å¹¶ç»Ÿè®¡æ•°æ®ï¼ˆæ ¸å¿ƒï¼‰
        function filterRecords() {
            const dimension = document.getElementById('viewDimension').value;
            const filterValue = document.getElementById('filterDate').value.trim();
            const records = getRecords();

            // ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
            let filteredRecords = [];
            if (dimension === 'day') {
                // æŒ‰æ—¥ç­›é€‰ï¼šç²¾ç¡®åŒ¹é…YYYY-MM-DD
                filteredRecords = records.filter(record => record.date === filterValue);
            } else if (dimension === 'month') {
                // æŒ‰æœˆç­›é€‰ï¼šåŒ¹é…YYYY-MMå¼€å¤´
                filteredRecords = records.filter(record => record.date.startsWith(filterValue));
            } else if (dimension === 'year') {
                // æŒ‰å¹´ç­›é€‰ï¼šåŒ¹é…YYYYå¼€å¤´
                filteredRecords = records.filter(record => record.date.startsWith(filterValue));
            }

            // åŸºç¡€ç»Ÿè®¡ï¼šæŒ‰è®°è´¦äºº+æ”¶æ”¯ç±»å‹æ±‡æ€»
            let husbandExpense = 0, wifeExpense = 0;
            let husbandIncome = 0, wifeIncome = 0;
            // åˆ†ç±»ç»Ÿè®¡ï¼šæŒ‰æ”¶æ”¯ç±»å‹+å…·ä½“åˆ†ç±»æ±‡æ€»
            const expenseCategoryTotal = {}, incomeCategoryTotal = {};
            // åˆå§‹åŒ–åˆ†ç±»ç»Ÿè®¡ï¼ˆé¿å…æ— æ•°æ®æ—¶æ˜¾ç¤ºç©ºï¼‰
            categoryData.æ”¯å‡º.forEach(cat => expenseCategoryTotal[cat] = 0);
            categoryData.æ”¶å…¥.forEach(cat => incomeCategoryTotal[cat] = 0);

            // éå†ç­›é€‰åçš„è®°å½•è®¡ç®—
            filteredRecords.forEach(record => {
                const { user, type, category, amount } = record;
                // åŸºç¡€ç»Ÿè®¡
                if (type === 'æ”¯å‡º') {
                    if (user === 'ä¸ˆå¤«') husbandExpense += amount;
                    else wifeExpense += amount;
                    // æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡
                    expenseCategoryTotal[category] += amount;
                } else {
                    if (user === 'ä¸ˆå¤«') husbandIncome += amount;
                    else wifeIncome += amount;
                    // æ”¶å…¥åˆ†ç±»ç»Ÿè®¡
                    incomeCategoryTotal[category] += amount;
                }
            });

            // è®¡ç®—æ±‡æ€»å€¼
            const totalExpense = husbandExpense + wifeExpense;
            const totalIncome = husbandIncome + wifeIncome;
            const totalBalance = totalIncome - totalExpense;

            // æ›´æ–°åŸºç¡€ç»Ÿè®¡æ˜¾ç¤º
            document.getElementById('husbandExpense').textContent = husbandExpense.toFixed(2);
            document.getElementById('wifeExpense').textContent = wifeExpense.toFixed(2);
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
            document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);

            // æ›´æ–°åˆ†ç±»æ˜ç»†ç»Ÿè®¡
            renderCategoryStats('expense', expenseCategoryTotal);
            renderCategoryStats('income', incomeCategoryTotal);

            // æ¸²æŸ“ç­›é€‰åçš„æ˜ç»†
            loadRecords(filteredRecords);
        }

        // 9. æ¸²æŸ“åˆ†ç±»æ˜ç»†ç»Ÿè®¡
        function renderCategoryStats(type, categoryTotal) {
            const gridId = type === 'expense' ? 'expenseCategoryGrid' : 'incomeCategoryGrid';
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            // éå†åˆ†ç±»ç»Ÿè®¡æ•°æ®ï¼Œåªæ˜¾ç¤ºæœ‰é‡‘é¢çš„åˆ†ç±»ï¼ˆä¼˜åŒ–è§†è§‰ï¼‰
            Object.entries(categoryTotal).forEach(([category, amount]) => {
                if (amount <= 0) return; // éšè—æ— é‡‘é¢çš„åˆ†ç±»
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="name">${category}</div>
                    <div class="value ${type === 'expense' ? 'expense' : 'income'}">${amount.toFixed(2)}</div>
                `;
                grid.appendChild(item);
            });

            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
            if (grid.children.length === 0) {
                grid.innerHTML = `<div class="category-item">æš‚æ— ${type === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}æ•°æ®</div>`;
            }
        }
    </script>
</body>
</html>
