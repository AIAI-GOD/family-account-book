<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©é¦¨å®¶åº­è®°è´¦æœ¬</title>
    <style>
        /* å…¨å±€æ ·å¼ - é«˜çº§è´¨æ„Ÿé£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            color: #4a4a48;
            font-weight: 400;
        }
        body {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f2ed;
            min-height: 100vh;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d9d6d0' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(150, 140, 130, 0.06);
            border: 1px solid rgba(233, 230, 225, 0.6);
        }
        h1 {
            text-align: center;
            color: #c87065;
            margin-bottom: 30px;
            letter-spacing: 2px;
            font-weight: 500;
            font-size: 22px;
        }

        /* å½•å…¥åŒºåŸŸæ ·å¼ */
        .input-section {
            border-bottom: 1px solid #e9e6e1;
            padding-bottom: 25px;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .form-group label {
            width: 80px;
            color: #5c5c59;
            font-weight: 500;
            flex-shrink: 0;
        }
        .form-group select, 
        .form-group input, 
        .form-group textarea {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 1px solid #e9e6e1;
            border-radius: 10px;
            font-size: 14px;
            background: #ffffff;
            transition: all 0.3s ease;
        }
        .form-group select:focus, 
        .form-group input:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #c87065;
            box-shadow: 0 0 0 3px rgba(200, 112, 101, 0.08);
        }
        .form-group button {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .form-group button:hover {
            background: #b46056;
        }
        .form-group .edit-btn {
            background: #7a9d7a; /* ä¿®æ”¹æŒ‰é’®ç”¨æ”¶å…¥çš„é¼ å°¾è‰ç»¿ï¼ŒåŒºåˆ†æ·»åŠ  */
        }
        .form-group .edit-btn:hover {
            background: #6a8d6a;
        }
        /* å¤‡æ³¨å¿«æ·çŸ­è¯­ */
        .remark-tags {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .remark-tag {
            padding: 5px 12px;
            background: #f8f6f3;
            border-radius: 6px;
            font-size: 12px;
            color: #5c5c59;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .remark-tag:hover {
            background: #f0ece7;
        }

        /* ç­›é€‰åŒºåŸŸ - æ—¥å†é€‰æ‹©å™¨æ ·å¼ */
        .filter-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-start;
            border: 1px solid #e9e6e1;
        }
        .filter-section label {
            font-weight: 500;
            color: #5c5c59;
            flex-shrink: 0;
            margin-top: 5px;
        }
        .filter-section select {
            padding: 10px 12px;
            border: 1px solid #e9e6e1;
            border-radius: 8px;
            flex-shrink: 0;
            min-width: 120px;
            transition: border 0.3s ease;
        }
        .filter-section select:focus {
            border-color: #c87065;
            outline: none;
        }
        /* æ—¥å†é€‰æ‹©å™¨å®¹å™¨ */
        .calendar-picker {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            margin-top: 5px;
        }
        /* æ—¥æœŸ/æœˆä»½/å¹´ä»½æŒ‰é’® */
        .calendar-btn {
            padding: 10px 0;
            border: 1px solid #e9e6e1;
            border-radius: 8px;
            background: #f8f6f3;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        .calendar-btn:hover {
            background: #f0ece7;
            border-color: #d9d6d0;
        }
        .calendar-btn.active {
            background: #c87065;
            color: white !important;
            border-color: #c87065;
        }
        .filter-section .query-btn {
            background: #c87065;
            color: white !important;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            flex-shrink: 0;
            margin-top: 5px;
        }
        .filter-section .query-btn:hover {
            background: #b46056;
        }

        /* ç»Ÿè®¡åŒºåŸŸ */
        .stats-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            border: 1px solid #e9e6e1;
        }
        .stats-title {
            font-weight: 500;
            color: #c87065;
            margin-bottom: 15px;
            font-size: 16px;
        }
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stats-item {
            padding: 15px;
            background: #f8f6f3;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s ease;
            border: 1px solid #e9e6e1;
        }
        .stats-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.08);
        }
        .stats-item .label {
            font-size: 13px;
            color: #8a8a86;
            margin-bottom: 8px;
            font-weight: 400;
        }
        .stats-item .value {
            font-size: 18px;
            font-weight: 500;
        }
        .expense {
            color: #d49667;
        }
        .income {
            color: #7a9d7a;
        }
        .balance {
            color: #c87065;
        }

        /* åˆ†ç±»æ˜ç»†ç»Ÿè®¡ */
        .category-stats {
            margin-top: 20px;
        }
        .category-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #5c5c59;
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        .category-item {
            padding: 10px;
            background: #f8f6f3;
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid #e9e6e1;
        }
        .category-item .name {
            color: #8a8a86;
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* æ˜ç»†åŒºåŸŸ */
        .records-section {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(150, 140, 130, 0.04);
            overflow: hidden;
            border: 1px solid #e9e6e1;
        }
        .records-section table {
            width: 100%;
            border-collapse: collapse;
        }
        .records-section th, .records-section td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9e6e1;
        }
        .records-section th {
            background: #f8f6f3;
            color: #5c5c59;
            font-weight: 500;
            font-size: 14px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .records-section tr:hover {
            background: #faf9f7;
        }
        .operate-btn {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .edit-btn {
            color: #7a9d7a;
            cursor: pointer;
            font-size: 13px;
            transition: color 0.3s ease;
        }
        .edit-btn:hover {
            color: #6a8d6a;
        }
        .delete-btn {
            color: #c87065;
            cursor: pointer;
            font-size: 13px;
            transition: color 0.3s ease;
        }
        .delete-btn:hover {
            color: #b46056;
        }
        /* é‡‘é¢åˆ—å³å¯¹é½ */
        .amount-col {
            text-align: right !important;
        }

        /* è‡ªå®šä¹‰åˆ é™¤ç¡®è®¤å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-box {
            background: #ffffff;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 24px rgba(150, 140, 130, 0.15);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-box {
            transform: translateY(0);
        }
        .modal-title {
            font-size: 18px;
            font-weight: 500;
            color: #4a4a48;
            margin-bottom: 15px;
            text-align: center;
        }
        .modal-content {
            font-size: 14px;
            color: #5c5c59;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }
        .modal-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .modal-btn {
            padding: 10px 25px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .modal-btn.cancel {
            background: #f8f6f3;
            color: #5c5c59;
        }
        .modal-btn.cancel:hover {
            background: #f0ece7;
        }
        .modal-btn.confirm {
            background: #c87065;
            color: white !important;
        }
        .modal-btn.confirm:hover {
            background: #b46056;
        }

        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: #8a8a86;
            text-align: center;
        }
        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            fill: #e9e6e1;
        }
        .empty-state-text {
            font-size: 14px;
            margin-bottom: 8px;
        }
        .empty-state-tip {
            font-size: 12px;
            color: #a0a09c;
        }

        /* ç»Ÿä¸€Toastæç¤ºæ ·å¼ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            color: white !important;
            z-index: 99999;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
            justify-content: center;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .toast.success {
            background: #7a9d7a;
        }
        .toast.info {
            background: #5c5c59;
        }
        .toast.warning {
            background: #d49667;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 12px;
            }
            .form-group {
                gap: 10px;
            }
            .form-group label {
                width: 70px;
            }
            .stats-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            .operate-btn {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
            .calendar-picker {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
            .modal-box {
                padding: 20px;
            }
            .empty-state svg {
                width: 80px;
                height: 80px;
            }
            /* ç§»åŠ¨ç«¯æ“ä½œæŒ‰é’®å›¾æ ‡åŒ– */
            .operate-btn span {
                display: flex;
                align-items: center;
                gap: 5px;
            }
            .operate-btn span::before {
                content: '';
                display: inline-block;
                width: 14px;
                height: 14px;
            }
            .edit-btn::before {
                content: 'âœï¸';
            }
            .delete-btn::before {
                content: 'ğŸ—‘ï¸';
            }
            .operate-btn span {
                font-size: 0;
            }
            .operate-btn span:hover {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ æ¸©é¦¨å®¶åº­è®°è´¦æœ¬</h1>
        
        <!-- è®°è´¦å½•å…¥åŒºåŸŸ -->
        <div class="input-section">
            <div class="form-group">
                <label>è®°è´¦äººï¼š</label>
                <select id="userSelect">
                    <option value="ä¸ˆå¤«">ä¸ˆå¤«</option>
                    <option value="å¦»å­">å¦»å­</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ”¶æ”¯ç±»å‹ï¼š</label>
                <select id="typeSelect" onchange="changeCategoryOptions()">
                    <option value="æ”¯å‡º">æ”¯å‡º</option>
                    <option value="æ”¶å…¥">æ”¶å…¥</option>
                </select>
            </div>
            <div class="form-group">
                <label>å…·ä½“åˆ†ç±»ï¼š</label>
                <select id="categorySelect">
                    <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»é€‰é¡¹ -->
                </select>
            </div>
            <div class="form-group">
                <label>é‡‘é¢ï¼š</label>
                <input type="number" id="amountInput" placeholder="è¯·è¾“å…¥é‡‘é¢" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸï¼š</label>
                <input type="date" id="dateInput">
                <!-- æ—¥æœŸå¿«æ·æŒ‰é’® -->
                <div style="display: flex; gap: 8px; flex-shrink: 0;">
                    <button type="button" style="padding: 8px 12px; font-size: 12px;" onclick="setQuickDate('today')">ä»Šæ—¥</button>
                    <button type="button" style="padding: 8px 12px; font-size: 12px;" onclick="setQuickDate('yesterday')">æ˜¨æ—¥</button>
                </div>
            </div>
            <div class="form-group">
                <label>å¤‡æ³¨ï¼š</label>
                <textarea id="remarkInput" placeholder="è®°å½•æ¶ˆè´¹/æ”¶å…¥åŸå› ï¼ˆå¯é€‰ï¼‰"></textarea>
                <!-- å¤‡æ³¨å¿«æ·çŸ­è¯­ -->
                <div class="remark-tags">
                    <div class="remark-tag" onclick="fillRemark('è¶…å¸‚é‡‡è´­')">è¶…å¸‚é‡‡è´­</div>
                    <div class="remark-tag" onclick="fillRemark('å¤–å–')">å¤–å–</div>
                    <div class="remark-tag" onclick="fillRemark('å·¥èµ„åˆ°è´¦')">å·¥èµ„åˆ°è´¦</div>
                    <div class="remark-tag" onclick="fillRemark('å…¶ä»–')">å…¶ä»–</div>
                </div>
            </div>
            <div class="form-group">
                <button id="addRecordBtn">âœ¨ æ·»åŠ è®°è´¦è®°å½•</button>
                <button id="editRecordBtn" class="edit-btn" style="display: none;">âœï¸ ä¿å­˜ä¿®æ”¹</button>
                <!-- éšè—çš„ä¿®æ”¹IDå­˜å‚¨ -->
                <input type="hidden" id="editRecordId" value="">
            </div>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ - é‡æ„ä¸ºæ—¥å†é€‰æ‹©å™¨ -->
        <div class="filter-section">
            <label>æŸ¥çœ‹ç»´åº¦ï¼š</label>
            <select id="viewDimension" onchange="renderCalendarPicker()">
                <option value="day">æŒ‰æ—¥æŸ¥çœ‹</option>
                <option value="month">æŒ‰æœˆæŸ¥çœ‹</option>
                <option value="year">æŒ‰å¹´æŸ¥çœ‹</option>
            </select>
            <!-- æŒ‰è®°è´¦äººç­›é€‰ -->
            <label>è®°è´¦äººï¼š</label>
            <select id="userFilter" onchange="filterRecords()">
                <option value="all">å…¨éƒ¨</option>
                <option value="ä¸ˆå¤«">ä¸ˆå¤«</option>
                <option value="å¦»å­">å¦»å­</option>
            </select>
            <!-- æ—¥å†é€‰æ‹©å™¨å®¹å™¨ -->
            <div class="calendar-picker" id="calendarPicker">
                <!-- åŠ¨æ€ç”Ÿæˆæ—¥æœŸ/æœˆä»½/å¹´ä»½æŒ‰é’® -->
            </div>
            <button class="query-btn" id="filterBtn">ğŸ” æŸ¥è¯¢</button>
        </div>

        <!-- ç»Ÿè®¡åŒºåŸŸ -->
        <div class="stats-section">
            <div class="stats-title" id="statsTitle">å½“æ—¥ç»Ÿè®¡ï¼ˆé»˜è®¤ä»Šæ—¥ï¼‰</div>
            
            <!-- æ±‡æ€»æ•°æ® - å®¶åº­æ€»æ”¯å‡º -->
            <div class="stats-summary">
                <div class="stats-item">
                    <div class="label">ä¸ˆå¤«æ”¯å‡º</div>
                    <div class="value expense" id="husbandExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å¦»å­æ”¯å‡º</div>
                    <div class="value expense" id="wifeExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»æ”¯å‡º</div>
                    <div class="value expense" id="totalExpense">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»æ”¶å…¥</div>
                    <div class="value income" id="totalIncome">0.00</div>
                </div>
                <div class="stats-item">
                    <div class="label">å®¶åº­æ€»ä½™é¢</div>
                    <div class="value balance" id="totalBalance">0.00</div>
                </div>
            </div>

            <!-- æ”¯å‡ºåˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="expenseCategoryStats">
                <div class="category-title">ğŸ“ æ”¯å‡ºåˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="expenseCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¯å‡ºåˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>

            <!-- æ”¶å…¥åˆ†ç±»æ˜ç»† -->
            <div class="category-stats" id="incomeCategoryStats">
                <div class="category-title">ğŸ’° æ”¶å…¥åˆ†ç±»æ˜ç»†</div>
                <div class="category-grid" id="incomeCategoryGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¶å…¥åˆ†ç±»ç»Ÿè®¡ -->
                </div>
            </div>
        </div>

        <!-- è®°è´¦æ˜ç»†åŒºåŸŸ -->
        <div class="records-section">
            <table>
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>è®°è´¦äºº</th>
                        <th>æ”¶æ”¯ç±»å‹</th>
                        <th>å…·ä½“åˆ†ç±»</th>
                        <th class="amount-col">é‡‘é¢</th>
                        <th>å¤‡æ³¨</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="recordsBody">
                    <!-- åŠ¨æ€æ¸²æŸ“è®°è´¦è®°å½• -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-box">
            <div class="modal-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            <div class="modal-content">
                ä½ ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°è´¦è®°å½•å—ï¼Ÿ<br>åˆ é™¤åæ•°æ®å°†<strong>æ— æ³•æ¢å¤</strong>ï¼Œè¯·è°¨æ…æ“ä½œï¼
            </div>
            <div class="modal-btns">
                <button class="modal-btn cancel" onclick="hideDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm" onclick="confirmDeleteRecord()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- Toastå®¹å™¨ -->
    <div class="toast" id="globalToast"></div>

    <script>
        // å®šä¹‰å¤šçº§åˆ†ç±»æ•°æ®
        const categoryData = {
            æ”¯å‡º: ['é¤é¥®', 'æœé¥°', 'ä½æˆ¿', 'äº¤é€š', 'å¨±ä¹', 'æ—¥ç”¨å“', 'åŒ»ç–—', 'è‚²å„¿', 'å…¶ä»–'],
            æ”¶å…¥: ['è–ªèµ„', 'å…¼èŒ', 'ç†è´¢', 'ç¤¼é‡‘', 'å…¶ä»–']
        };

        // å…¨å±€å˜é‡ï¼šå­˜å‚¨å½“å‰é€‰ä¸­çš„æ—¥æœŸ/æœˆä»½/å¹´ä»½ã€å¾…åˆ é™¤çš„è®°å½•ID
        let currentSelectValue = '';
        let waitDeleteRecordId = null;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            
            // åˆå§‹åŒ–åˆ†ç±»é€‰é¡¹
            changeCategoryOptions();
            // åŠ è½½è¡¨å•è®°å¿†çŠ¶æ€
            loadFormState();
            // åˆå§‹åŒ–æ—¥å†é€‰æ‹©å™¨
            renderCalendarPicker();
            // åŠ è½½æœ¬åœ°æ•°æ®
            loadRecords();
            // åˆå§‹åŒ–ç»Ÿè®¡
            filterRecords();

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('addRecordBtn').addEventListener('click', addRecord);
            document.getElementById('editRecordBtn').addEventListener('click', saveEditRecord);
            document.getElementById('filterBtn').addEventListener('click', filterRecords);
            
            // é‡‘é¢è¾“å…¥æ¡†ç»‘å®šå¤±ç„¦äº‹ä»¶ï¼ˆè‡ªåŠ¨ä¿ç•™ä¸¤ä½å°æ•°ï¼‰
            document.getElementById('amountInput').addEventListener('blur', function() {
                this.value = formatAmount(this.value);
            });
        });

        // 1. åˆ‡æ¢æ”¶æ”¯ç±»å‹æ—¶ï¼Œæ›´æ–°å…·ä½“åˆ†ç±»é€‰é¡¹
        function changeCategoryOptions() {
            const typeSelect = document.getElementById('typeSelect');
            const categorySelect = document.getElementById('categorySelect');
            const currentType = typeSelect.value;
            const categories = categoryData[currentType];

            categorySelect.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
            // åˆ‡æ¢ç±»å‹åä¿å­˜è¡¨å•çŠ¶æ€
            saveFormState();
        }

        // 2. æ¸²æŸ“æ—¥å†é€‰æ‹©å™¨ï¼ˆæ ¸å¿ƒï¼šæ—¥/æœˆ/å¹´ç»´åº¦åˆ‡æ¢ï¼‰
        function renderCalendarPicker() {
            const dimension = document.getElementById('viewDimension').value;
            const calendarPicker = document.getElementById('calendarPicker');
            calendarPicker.innerHTML = '';
            const today = new Date();
            
            // æ›´æ–°ç»Ÿè®¡æ ‡é¢˜
            const statsTitle = document.getElementById('statsTitle');
            
            if (dimension === 'day') {
                // æ—¥ç»´åº¦ï¼šç”Ÿæˆå½“æœˆæ‰€æœ‰å¤©æ•°
                const year = today.getFullYear();
                const month = today.getMonth();
                // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const totalDays = lastDay.getDate();
                
                // é»˜è®¤é€‰ä¸­ä»Šå¤©
                const defaultDay = today.getDate();
                currentSelectValue = `${year}-${String(month + 1).padStart(2, '0')}-${String(defaultDay).padStart(2, '0')}`;
                
                // ç”Ÿæˆå¤©æ•°æŒ‰é’®
                for (let i = 1; i <= totalDays; i++) {
                    const dayStr = String(i).padStart(2, '0');
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${dayStr}`;
                    const btn = createCalendarBtn(dayStr, dateStr, dateStr === currentSelectValue);
                    calendarPicker.appendChild(btn);
                }
                
                statsTitle.textContent = `ğŸ“… å½“æ—¥ç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
            } else if (dimension === 'month') {
                // æœˆç»´åº¦ï¼šç”Ÿæˆå½“å¹´æ‰€æœ‰æœˆä»½
                const year = today.getFullYear();
                const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
                // é»˜è®¤é€‰ä¸­å½“æœˆ
                const defaultMonth = String(today.getMonth() + 1).padStart(2, '0');
                currentSelectValue = `${year}-${defaultMonth}`;
                
                // ç”Ÿæˆæœˆä»½æŒ‰é’®
                months.forEach(month => {
                    const monthName = `${month}æœˆ`;
                    const monthStr = `${year}-${month}`;
                    const btn = createCalendarBtn(monthName, monthStr, monthStr === currentSelectValue);
                    calendarPicker.appendChild(btn);
                });
                
                statsTitle.textContent = `ğŸ“† å½“æœˆç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
            } else if (dimension === 'year') {
                // å¹´ç»´åº¦ï¼šç”Ÿæˆè¿‘5å¹´
                const currentYear = today.getFullYear();
                const years = [];
                for (let i = currentYear; i >= currentYear - 4; i--) {
                    years.push(i);
                }
                // é»˜è®¤é€‰ä¸­å½“å¹´
                currentSelectValue = `${currentYear}`;
                
                // ç”Ÿæˆå¹´ä»½æŒ‰é’®
                years.forEach(year => {
                    const yearStr = `${year}`;
                    const btn = createCalendarBtn(yearStr + 'å¹´', yearStr, yearStr === currentSelectValue);
                    calendarPicker.appendChild(btn);
                });
                
                statsTitle.textContent = `ğŸ“ˆ å½“å¹´ç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
            }
        }

        // 3. åˆ›å»ºæ—¥å†æŒ‰é’®ï¼ˆå·¥å…·å‡½æ•°ï¼‰
        function createCalendarBtn(text, value, isActive) {
            const btn = document.createElement('div');
            btn.className = `calendar-btn ${isActive ? 'active' : ''}`;
            btn.textContent = text;
            btn.dataset.value = value;
            
            // ç‚¹å‡»åˆ‡æ¢é€‰ä¸­çŠ¶æ€
            btn.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                document.querySelectorAll('.calendar-btn').forEach(item => {
                    item.classList.remove('active');
                });
                // æ·»åŠ å½“å‰æŒ‰é’®çš„activeç±»
                this.classList.add('active');
                // æ›´æ–°é€‰ä¸­å€¼
                currentSelectValue = this.dataset.value;
                // æ›´æ–°ç»Ÿè®¡æ ‡é¢˜
                const dimension = document.getElementById('viewDimension').value;
                const statsTitle = document.getElementById('statsTitle');
                if (dimension === 'day') {
                    statsTitle.textContent = `ğŸ“… å½“æ—¥ç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
                } else if (dimension === 'month') {
                    statsTitle.textContent = `ğŸ“† å½“æœˆç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
                } else if (dimension === 'year') {
                    statsTitle.textContent = `ğŸ“ˆ å½“å¹´ç»Ÿè®¡ï¼ˆ${currentSelectValue}ï¼‰`;
                }
            });
            
            return btn;
        }

        // 4. æœ¬åœ°å­˜å‚¨æ“ä½œ - è·å–æ‰€æœ‰è®°å½•
        function getRecords() {
            const records = localStorage.getItem('familyAccountRecords');
            return records ? JSON.parse(records) : [];
        }

        // 5. æœ¬åœ°å­˜å‚¨æ“ä½œ - ä¿å­˜è®°å½•
        function saveRecords(records) {
            localStorage.setItem('familyAccountRecords', JSON.stringify(records));
        }

        // 6. è¡¨å•è®°å¿†çŠ¶æ€ - ä¿å­˜
        function saveFormState() {
            const formState = {
                user: document.getElementById('userSelect').value,
                type: document.getElementById('typeSelect').value,
                category: document.getElementById('categorySelect').value
            };
            localStorage.setItem('familyAccountFormState', JSON.stringify(formState));
        }

        // 7. è¡¨å•è®°å¿†çŠ¶æ€ - åŠ è½½
        function loadFormState() {
            const state = localStorage.getItem('familyAccountFormState');
            if (state) {
                const formState = JSON.parse(state);
                document.getElementById('userSelect').value = formState.user || 'ä¸ˆå¤«';
                document.getElementById('typeSelect').value = formState.type || 'æ”¯å‡º';
                // å…ˆæ›´æ–°åˆ†ç±»é€‰é¡¹ï¼Œå†è®¾ç½®åˆ†ç±»
                changeCategoryOptions();
                document.getElementById('categorySelect').value = formState.category || categoryData[formState.type || 'æ”¯å‡º'][0];
            }
        }

        // 8. é‡‘é¢æ ¼å¼åŒ– - è‡ªåŠ¨ä¿ç•™ä¸¤ä½å°æ•°
        function formatAmount(amount) {
            if (!amount || isNaN(amount) || amount <= 0) {
                return '';
            }
            // ä¿ç•™ä¸¤ä½å°æ•°
            return parseFloat(amount).toFixed(2);
        }

        // 9. ç»Ÿä¸€Toastæç¤º - æ ¸å¿ƒä¼˜åŒ–
        function showToast(message, type = 'info') {
            const toast = document.getElementById('globalToast');
            // ç±»å‹ï¼šsuccess(æˆåŠŸ)ã€info(æç¤º)ã€warning(è­¦å‘Š)
            const typeClass = {
                success: 'success',
                info: 'info',
                warning: 'warning'
            };
            // å›¾æ ‡
            const icon = {
                success: 'âœ…',
                info: 'ğŸ’¡',
                warning: 'âš ï¸'
            };
            
            // è®¾ç½®Toastå†…å®¹å’Œæ ·å¼
            toast.className = `toast ${typeClass[type]}`;
            toast.innerHTML = `${icon[type]} ${message}`;
            
            // æ˜¾ç¤ºToast
            toast.classList.add('show');
            
            // 3ç§’åéšè—
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // 10. æ—¥æœŸå¿«æ·è®¾ç½®
        function setQuickDate(type) {
            const date = new Date();
            if (type === 'yesterday') {
                date.setDate(date.getDate() - 1);
            }
            const formattedDate = date.toISOString().split('T')[0];
            document.getElementById('dateInput').value = formattedDate;
        }

        // 11. å¤‡æ³¨å¿«æ·å¡«å……
        function fillRemark(text) {
            document.getElementById('remarkInput').value = text;
        }

        // 12. é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('amountInput').value = '';
            document.getElementById('remarkInput').value = '';
            // ä¿ç•™è®°è´¦äºº/ç±»å‹/åˆ†ç±»çš„è®°å¿†ï¼Œä»…æ¸…ç©ºé‡‘é¢å’Œå¤‡æ³¨
        }

        // 13. æ·»åŠ è®°è´¦è®°å½•
        function addRecord() {
            // è·å–è¡¨å•æ•°æ®
            const user = document.getElementById('userSelect').value;
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const date = document.getElementById('dateInput').value;
            const remark = document.getElementById('remarkInput').value.trim();

            // è¡¨å•éªŒè¯
            if (!amount || isNaN(amount) || amount <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï¼', 'warning');
                return;
            }
            if (!date) {
                showToast('è¯·é€‰æ‹©è®°è´¦æ—¥æœŸï¼', 'warning');
                return;
            }

            // åˆ›å»ºæ–°è®°å½•
            const newRecord = {
                id: Date.now(),
                user: user,
                type: type,
                category: category,
                amount: amount,
                date: date,
                remark: remark
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const records = getRecords();
            records.push(newRecord);
            saveRecords(records);

            // ä¿å­˜è¡¨å•çŠ¶æ€ï¼ˆè®°å¿†é€‰æ‹©ï¼‰
            saveFormState();
            // é‡ç½®è¡¨å•
            resetForm();

            // é‡æ–°åŠ è½½æ•°æ®å’Œç»Ÿè®¡
            loadRecords();
            filterRecords();
            showToast('è®°è´¦æˆåŠŸï¼', 'success');
        }

        // 14. åŠ è½½å¹¶æ¸²æŸ“è®°è´¦æ˜ç»†ï¼ˆç©ºçŠ¶æ€ä¼˜åŒ–ï¼‰
        function loadRecords(filteredRecords = null) {
            const records = filteredRecords || getRecords();
            const recordsBody = document.getElementById('recordsBody');
            recordsBody.innerHTML = '';

            // ç©ºçŠ¶æ€å¤„ç†
            if (records.length === 0) {
                recordsBody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                                    <path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0-7c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4z"/>
                                    <path d="M7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7zm6-8h2v2h-2zm0 4h2v2h-2zm0 4h2v2h-2zm6-8h2v2h-2zm0 4h2v2h-2z"/>
                                </svg>
                                <div class="empty-state-text">æš‚æ— è®°è´¦è®°å½•</div>
                                <div class="empty-state-tip">ç‚¹å‡»âœ¨æ·»åŠ è®°è´¦è®°å½•ï¼Œå¼€å§‹ä½ çš„è®°è´¦ä¹‹æ—…å§ï½</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            // å€’åºæ˜¾ç¤º
            const reversedRecords = [...records].reverse();
            reversedRecords.forEach(record => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.user}</td>
                    <td>${record.type}</td>
                    <td>${record.category}</td>
                    <td class="amount-col">${record.amount.toFixed(2)}</td>
                    <td>${record.remark || '-'}</td>
                    <td class="operate-btn">
                        <span class="edit-btn" onclick="editRecord(${record.id})">ä¿®æ”¹</span>
                        <span class="delete-btn" onclick="showDeleteModal(${record.id})">åˆ é™¤</span>
                    </td>
                `;
                recordsBody.appendChild(tr);
            });
        }

        // 15. ç¼–è¾‘è®°å½• - å›å¡«æ•°æ®åˆ°è¡¨å•
        function editRecord(recordId) {
            const records = getRecords();
            const record = records.find(item => item.id === recordId);
            if (!record) return;

            // å›å¡«æ•°æ®åˆ°è¡¨å•
            document.getElementById('userSelect').value = record.user;
            document.getElementById('typeSelect').value = record.type;
            // å…ˆæ›´æ–°åˆ†ç±»é€‰é¡¹ï¼Œå†é€‰å¯¹åº”åˆ†ç±»
            changeCategoryOptions();
            document.getElementById('categorySelect').value = record.category;
            document.getElementById('amountInput').value = record.amount.toFixed(2);
            document.getElementById('dateInput').value = record.date;
            document.getElementById('remarkInput').value = record.remark || '';

            // å­˜å‚¨å½“å‰ä¿®æ”¹çš„è®°å½•ID
            document.getElementById('editRecordId').value = recordId;

            // åˆ‡æ¢æŒ‰é’®æ˜¾ç¤ºï¼šéšè—æ·»åŠ ï¼Œæ˜¾ç¤ºä¿®æ”¹
            document.getElementById('addRecordBtn').style.display = 'none';
            document.getElementById('editRecordBtn').style.display = 'inline-block';
        }

        // 16. ä¿å­˜ä¿®æ”¹åçš„è®°å½•
        function saveEditRecord() {
            const editId = parseInt(document.getElementById('editRecordId').value);
            if (!editId) return;

            // è·å–ä¿®æ”¹åçš„è¡¨å•æ•°æ®
            const user = document.getElementById('userSelect').value;
            const type = document.getElementById('typeSelect').value;
            const category = document.getElementById('categorySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const date = document.getElementById('dateInput').value;
            const remark = document.getElementById('remarkInput').value.trim();

            // è¡¨å•éªŒè¯
            if (!amount || isNaN(amount) || amount <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï¼', 'warning');
                return;
            }
            if (!date) {
                showToast('è¯·é€‰æ‹©è®°è´¦æ—¥æœŸï¼', 'warning');
                return;
            }

            // æ‰¾åˆ°å¹¶æ›´æ–°è®°å½•
            let records = getRecords();
            records = records.map(item => {
                if (item.id === editId) {
                    return {
                        ...item,
                        user: user,
                        type: type,
                        category: category,
                        amount: amount,
                        date: date,
                        remark: remark
                    };
                }
                return item;
            });

            // ä¿å­˜ä¿®æ”¹
            saveRecords(records);
            // ä¿å­˜è¡¨å•çŠ¶æ€
            saveFormState();

            // é‡ç½®è¡¨å•å’ŒæŒ‰é’®çŠ¶æ€
            resetForm();
            document.getElementById('addRecordBtn').style.display = 'inline-block';
            document.getElementById('editRecordBtn').style.display = 'none';

            // é‡æ–°åŠ è½½æ•°æ®å’Œç»Ÿè®¡
            loadRecords();
            filterRecords();
            showToast('è®°å½•ä¿®æ”¹æˆåŠŸï¼', 'success');
        }

        // 17. æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¼¹çª—
        function showDeleteModal(recordId) {
            waitDeleteRecordId = recordId;
            document.getElementById('deleteModal').classList.add('show');
        }

        // 18. éšè—åˆ é™¤ç¡®è®¤å¼¹çª—
        function hideDeleteModal() {
            waitDeleteRecordId = null;
            document.getElementById('deleteModal').classList.remove('show');
        }

        // 19. ç¡®è®¤åˆ é™¤è®°å½•
        function confirmDeleteRecord() {
            if (!waitDeleteRecordId) return;

            let records = getRecords();
            records = records.filter(record => record.id !== waitDeleteRecordId);
            saveRecords(records);
            loadRecords();
            filterRecords();
            
            // éšè—å¼¹çª—å¹¶æç¤º
            hideDeleteModal();
            showToast('è®°å½•å·²æˆåŠŸåˆ é™¤ï¼', 'success');
        }

        // 20. ç­›é€‰å¹¶ç»Ÿè®¡æ•°æ®ï¼ˆæ–°å¢æŒ‰è®°è´¦äººç­›é€‰ï¼‰
        function filterRecords() {
            const dimension = document.getElementById('viewDimension').value;
            const userFilter = document.getElementById('userFilter').value;
            const filterValue = currentSelectValue;
            const records = getRecords();

            // ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
            let filteredRecords = [];
            if (dimension === 'day') {
                // æŒ‰æ—¥ç­›é€‰ï¼šç²¾ç¡®åŒ¹é…YYYY-MM-DD
                filteredRecords = records.filter(record => record.date === filterValue);
            } else if (dimension === 'month') {
                // æŒ‰æœˆç­›é€‰ï¼šåŒ¹é…YYYY-MMå¼€å¤´
                filteredRecords = records.filter(record => record.date.startsWith(filterValue));
            } else if (dimension === 'year') {
                // æŒ‰å¹´ç­›é€‰ï¼šåŒ¹é…YYYYå¼€å¤´
                filteredRecords = records.filter(record => record.date.startsWith(filterValue));
            }

            // æŒ‰è®°è´¦äººç­›é€‰
            if (userFilter !== 'all') {
                filteredRecords = filteredRecords.filter(record => record.user === userFilter);
            }

            // åŸºç¡€ç»Ÿè®¡
            let husbandExpense = 0, wifeExpense = 0;
            let husbandIncome = 0, wifeIncome = 0;
            // åˆ†ç±»ç»Ÿè®¡
            const expenseCategoryTotal = {}, incomeCategoryTotal = {};
            categoryData.æ”¯å‡º.forEach(cat => expenseCategoryTotal[cat] = 0);
            categoryData.æ”¶å…¥.forEach(cat => incomeCategoryTotal[cat] = 0);

            // éå†è®¡ç®—
            filteredRecords.forEach(record => {
                const { user, type, category, amount } = record;
                if (type === 'æ”¯å‡º') {
                    if (user === 'ä¸ˆå¤«') husbandExpense += amount;
                    else wifeExpense += amount;
                    expenseCategoryTotal[category] += amount;
                } else {
                    if (user === 'ä¸ˆå¤«') husbandIncome += amount;
                    else wifeIncome += amount;
                    incomeCategoryTotal[category] += amount;
                }
            });

            // è®¡ç®—æ±‡æ€»å€¼
            const totalExpense = husbandExpense + wifeExpense;
            const totalIncome = husbandIncome + wifeIncome;
            const totalBalance = totalIncome - totalExpense;

            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            document.getElementById('husbandExpense').textContent = husbandExpense.toFixed(2);
            document.getElementById('wifeExpense').textContent = wifeExpense.toFixed(2);
            document.getElementById('totalExpense').textContent = totalExpense.toFixed(2);
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
            document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);

            // æ›´æ–°åˆ†ç±»æ˜ç»†ç»Ÿè®¡ï¼ˆç©ºçŠ¶æ€ä¼˜åŒ–ï¼‰
            renderCategoryStats('expense', expenseCategoryTotal);
            renderCategoryStats('income', incomeCategoryTotal);

            // æ¸²æŸ“ç­›é€‰åçš„æ˜ç»†
            loadRecords(filteredRecords);
        }

        // 21. æ¸²æŸ“åˆ†ç±»æ˜ç»†ç»Ÿè®¡ï¼ˆç©ºçŠ¶æ€ä¼˜åŒ–ï¼‰
        function renderCategoryStats(type, categoryTotal) {
            const gridId = type === 'expense' ? 'expenseCategoryGrid' : 'incomeCategoryGrid';
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
            const hasData = Object.values(categoryTotal).some(amount => amount > 0);
            if (!hasData) {
                const emptySvg = type === 'expense' 
                    ? `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="80" height="80">
                        <path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/>
                      </svg>`
                    : `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="80" height="80">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                      </svg>`;
                const emptyText = type === 'expense' ? 'æš‚æ— æ”¯å‡ºæ•°æ®' : 'æš‚æ— æ”¶å…¥æ•°æ®';
                grid.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        ${emptySvg}
                        <div class="empty-state-text">${emptyText}</div>
                    </div>
                `;
                return;
            }

            // æ¸²æŸ“æœ‰æ•°æ®çš„åˆ†ç±»
            Object.entries(categoryTotal).forEach(([category, amount]) => {
                if (amount <= 0) return;
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="name">${category}</div>
                    <div class="${type === 'expense' ? 'expense' : 'income'} amount-col">${amount.toFixed(2)}</div>
                `;
                grid.appendChild(item);
            });
        }
    </script>
</body>
</html>
